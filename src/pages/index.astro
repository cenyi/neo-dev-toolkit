---
import BaseLayout from '../layouts/BaseLayout.astro';
import Sidebar from '../components/Sidebar.astro';
import { locales } from '../i18n/locales.js';

// Ëã±ÊñáÈ¶ñÈ°µÔºåÂõ∫ÂÆö‰ΩøÁî®Ëã±ÊñáËØ≠Ë®Ä
const lang = 'en-US';
const t = locales['en'];
---

<BaseLayout
  title="JSON Tools - Format, Compare & Convert JSON Online"
  lang={lang}
  description="Free online JSON tools: Format, validate, compare & convert JSON to CSV, Excel, XML, YAML. Browser-based, secure. JSON diff, minify, beautifier & parser."
  keywords="JSON formatter, JSON validator, JSON parser, JSON compare, JSON diff, JSON minify, JSON to CSV, JSON to Excel, CSV to JSON, Excel to JSON, JSON to XML, JSON to YAML, JSON to TypeScript, JSON to table, JSON to csv converter, JSON to excel converter, JSON stringify, JSON escape, JSON beautifier, JSON viewer, JSON editor, JSON tools, URL params parser, JSON comparison online, JSON pretty print, JSON file converter, XML to JSON, YAML to JSON, string to JSON, text to JSON, HTML to JSON, PDF to JSON, image to JSON, XLSX to JSON, json2video, json2csv, jsoncompare, jsondiff, jsonminifier, jsonview, jsonrpc, jsonschema, jsonata, json5, jsonc, nlohmann json, python json, mysql json, online JSON tool, free JSON formatter, JSON checker, JSON analyzer, JSON converter online">
  <Sidebar slot="sidebar" t={t} />

  <!-- Schema.org Structured Data for SEO & GEO -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "JSON Formatter & Parser",
    "description": "Free online JSON formatter, validator, and converter. Support JSON, URL params, XML, YAML conversion with field extraction, TypeScript generation.",
    "url": "https://tojsons.com",
    "applicationCategory": "DeveloperApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "featureList": [
      "JSON Formatting and Validation",
      "URL Parameters Parsing",
      "XML to JSON Conversion",
      "YAML to JSON Conversion",
      "Field Extraction with JavaScript",
      "TypeScript Interface Generation",
      "JSON to XML Conversion",
      "JSON Minification",
      "JSON Escaping",
      "Comment Removal"
    ],
    "browserRequirements": "Requires JavaScript. Compatible with all modern browsers.",
    "softwareVersion": "1.0.0",
    "author": {
      "@type": "Organization",
      "name": "JSON Viewer Team"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "1250"
    }
  })} />

  <div class="json-formatter-container"
       data-enter-extraction-fn={t.enterExtractionFn}
       data-enter-data={t.enterData}
       data-extraction-error={t.extractionError}
       data-parsing-error={t.parsingError}
       data-compress-success={t.compressSuccess}
       data-escape-success={t.escapeSuccess}
       data-xml-success={t.xmlSuccess}
       data-ts-success={t.tsSuccess}
       data-csv-success={t.csvSuccess}
       data-excel-success={t.excelSuccess}>

    <div class="editor-workspace">
      <!-- Â∑¶‰æßËæìÂÖ•Âå∫Âüü -->
      <div class="input-area">
        <!-- ÁºñËæëÂô®ÂÆπÂô®ÔºàÁî®‰∫éÂ∑¶Âè≥Â∏ÉÂ±ÄÔºâ -->
        <div class="editors-wrapper" id="editors-wrapper">
          <!-- ‰∏§‰∏™Áã¨Á´ãÁºñËæëÂô® -->
          <div class="input-section">
            <div class="section-header-row">
              <h1 class="section-label">All-in-One JSON Viewer</h1>
              <div class="editor-hint-inline" id="editor-hint">
                <span class="hint-icon">‚ú®</span>
                <span class="hint-text">Smart Input: Auto-detects JSON, URL, XML & YAML</span>
              </div>
            </div>
            <div class="input-editor-wrapper">
              <div id="monaco-editor-container" class="monaco-editor-container"></div>
            </div>
          </div>

          <!-- ÊØîËæÉÊ®°ÂºèÔºöÁ¨¨‰∫å‰∏™ÁºñËæëÂô® -->
          <div class="input-section compare-editor hidden" id="compare-section">
            <h2 class="section-label">{t.rightJson}</h2>
            <div class="input-editor-wrapper">
              <div id="monaco-compare-container" class="monaco-editor-container"></div>
            </div>
          </div>
        </div>

        <!-- JSON Ê†°È™åÈîôËØØÊèêÁ§∫ -->
        <div id="json-validation-error" class="validation-error hidden"></div>

        <div class="extraction-section">
          <div class="extraction-controls">
            <label for="extract-fn">üìä {t.extractionLabel}</label>
            <input
              type="text"
              id="extract-fn"
              placeholder={t.extractionPlaceholder}
            />
            <button id="apply-extract">{t.apply}</button>
            <button id="clear-extract-fn">{t.clear}</button>
          </div>
        </div>

        <div class="output-controls">
          <button id="collapse-all">{t.collapseAll}</button>
          <button id="expand-all">{t.expandAll}</button>
          <button id="remove-comments">{t.removeComments}</button>
          <button id="compress-copy">{t.compressCopy}</button>
          <button id="escape-copy">{t.escapeCopy}</button>
          <button id="json-to-xml">{t.jsonToXml}</button>
          <button id="json-to-ts">{t.jsonToTs}</button>
          <button id="json-to-csv">{t.jsonToCsv}</button>
          <button id="json-to-excel">{t.jsonToExcel}</button>
          <button id="json-compare">{t.jsonCompare}</button>
          <button id="clear-btn">{t.clear}</button>
          <button id="history-btn">{t.history}</button>
          <select id="font-size-select" title="Font Size">
            <option value="11">11px</option>
            <option value="12">12px</option>
            <option value="13" selected>13px</option>
            <option value="14">14px</option>
            <option value="15">15px</option>
            <option value="16">16px</option>
          </select>
        </div>
      </div>

      <!-- Âè≥‰æßËæìÂá∫Âå∫Âüü -->
      <div class="output-area" id="output-area">
        <div class="output-header">
          <span class="output-title" id="output-title">ËæìÂá∫ÁªìÊûú</span>
          <button class="close-output-btn" id="close-output" title="ÂÖ≥Èó≠">√ó</button>
        </div>
        <div class="output-content" id="output-content">
          <div class="output-editor-wrapper">
            <div id="output-monaco-container" class="monaco-editor-container"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- HowTo Tutorial Section -->
  <div class="tutorial-section">
    <div class="section-header">
      <h2>{t.tutorialTitle}</h2>
      <p>{t.tutorialSubtitle}</p>
    </div>

    <div class="tutorial-container">
      <div class="tutorial-step">
        <div class="step-number">1</div>
        <div class="step-content">
          <h3>{t.tutorialStep1Title}</h3>
          <p>{t.tutorialStep1Desc}</p>
          <div class="step-example">
            <code set:text={t.tutorialStep1Example}></code>
          </div>
        </div>
      </div>

      <div class="tutorial-step">
        <div class="step-number">2</div>
        <div class="step-content">
          <h3>{t.tutorialStep2Title}</h3>
          <p>{t.tutorialStep2Desc}</p>
          <div class="tip">
            <strong>üí° {t.tutorialStep2Tip.split(':')[0]}:</strong> {t.tutorialStep2Tip.split(':')[1]}
          </div>
        </div>
      </div>

      <div class="tutorial-step">
        <div class="step-number">3</div>
        <div class="step-content">
          <h3>{t.tutorialStep3Title}</h3>
          <p set:text={t.tutorialStep3Desc}></p>
          <div class="step-example">
            <code set:text={t.tutorialStep3Example}></code>
          </div>
          <p class="example-desc" set:text={t.tutorialStep3ExampleDesc}></p>
        </div>
      </div>

      <div class="tutorial-step">
        <div class="step-number">4</div>
        <div class="step-content">
          <h3>{t.tutorialStep4Title}</h3>
          <p>{t.tutorialStep4Desc}</p>
          <div class="step-example">
            <pre><code set:text={t.tutorialStep4Example}></code></pre>
          </div>
          <p class="example-desc" set:text={t.tutorialStep4ExampleDesc}></p>
        </div>
      </div>

      <div class="tutorial-step">
        <div class="step-number">5</div>
        <div class="step-content">
          <h3>{t.tutorialStep5Title}</h3>
          <p>{t.tutorialStep5Desc}</p>
          <ul class="action-list">
            <li><strong>{t.tutorialStep5Action1.split(':')[0]}:</strong> {t.tutorialStep5Action1.split(':')[1]}</li>
            <li><strong>{t.tutorialStep5Action2.split(':')[0]}:</strong> {t.tutorialStep5Action2.split(':')[1]}</li>
            <li><strong>{t.tutorialStep5Action3.split(':')[0]}:</strong> {t.tutorialStep5Action3.split(':')[1]}</li>
            <li><strong>{t.tutorialStep5Action4.split(':')[0]}:</strong> {t.tutorialStep5Action4.split(':')[1]}</li>
            <li><strong>{t.tutorialStep5Action5.split(':')[0]}:</strong> {t.tutorialStep5Action5.split(':')[1]}</li>
          </ul>
        </div>
      </div>

      <div class="tutorial-step">
        <div class="step-number">6</div>
        <div class="step-content">
          <h3>{t.tutorialStep6Title}</h3>
          <p>{t.tutorialStep6Desc}</p>
          <div class="privacy-note">
            <strong>üîí {t.tutorialStep6Privacy.split(':')[0]}:</strong> {t.tutorialStep6Privacy.split(':')[1]}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Features Section -->
    <div class="features-section">
      <div class="section-header">
        <h2>{t.featuresTitle}</h2>
        <p>{t.featuresSubtitle}</p>
      </div>
      <div class="features-grid">
        <div class="feature-item">
          <div class="feature-number">01</div>
          <div class="feature-content">
            <div class="feature-icon">‚ú®</div>
            <h3>{t.feature1Title}</h3>
            <p>{t.feature1Desc}</p>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-number">02</div>
          <div class="feature-content">
            <div class="feature-icon">üîÑ</div>
            <h3>{t.feature2Title}</h3>
            <p>{t.feature2Desc}</p>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-number">03</div>
          <div class="feature-content">
            <div class="feature-icon">üéØ</div>
            <h3>{t.feature3Title}</h3>
            <p>{t.feature3Desc}</p>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-number">04</div>
          <div class="feature-content">
            <div class="feature-icon">‚ö°</div>
            <h3>{t.feature4Title}</h3>
            <p>{t.feature4Desc}</p>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-number">05</div>
          <div class="feature-content">
            <div class="feature-icon">üíª</div>
            <h3>{t.feature5Title}</h3>
            <p>{t.feature5Desc}</p>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-number">06</div>
          <div class="feature-content">
            <div class="feature-icon">üîí</div>
            <h3>{t.feature6Title}</h3>
            <p>{t.feature6Desc}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Supported Formats Section -->
    <div class="supported-formats-section">
      <div class="section-header">
        <h2>Supported JSON Conversion Features</h2>
        <p>One-stop JSON toolkit for all your JSON processing needs</p>
      </div>
      <div class="formats-grid">
        <div class="format-category">
          <h3>üìä JSON Formatting</h3>
          <ul>
            <li>JSON Formatter</li>
            <li>JSON Beautifier</li>
            <li>JSON Minify</li>
            <li>JSON Validator</li>
            <li>JSON Escape</li>
            <li>JSON Viewer</li>
          </ul>
        </div>
        <div class="format-category">
          <h3>üîÑ JSON Conversion</h3>
          <ul>
            <li>JSON to CSV Converter</li>
            <li>JSON to Excel</li>
            <li>JSON to XML</li>
            <li>JSON to YAML</li>
            <li>JSON to TypeScript</li>
            <li>JSON to Table</li>
          </ul>
        </div>
        <div class="format-category">
          <h3>‚û°Ô∏è Convert to JSON</h3>
          <ul>
            <li>CSV to JSON</li>
            <li>Excel to JSON</li>
            <li>XML to JSON</li>
            <li>YAML to JSON</li>
            <li>URL Params to JSON</li>
            <li>String to JSON</li>
          </ul>
        </div>
        <div class="format-category">
          <h3>üîß JSON Tools</h3>
          <ul>
            <li>JSON Compare / JSON Diff</li>
            <li>Compare JSON Online</li>
            <li>Field Extraction</li>
            <li>JSON Path Finder</li>
            <li>JSON History</li>
            <li>Remove Comments</li>
          </ul>
        </div>
        <div class="format-category">
          <h3>üíª Developer Tools</h3>
          <ul>
            <li>TypeScript Interface</li>
            <li>JSON Schema Generator</li>
            <li>JSON Code Examples</li>
            <li>Syntax Highlighting</li>
            <li>Error Detection</li>
            <li>Line Numbers</li>
          </ul>
        </div>
        <div class="format-category">
          <h3>üîí Security Features</h3>
          <ul>
            <li>100% Browser-based</li>
            <li>Local Processing</li>
            <li>No Server Upload</li>
            <li>Works Offline</li>
            <li>Privacy First</li>
            <li>Secure Processing</li>
          </ul>
        </div>
      </div>
      <div class="formats-note">
        <p>üí° <strong>Tip:</strong> All JSON processing happens locally in your browser. Supports large JSON files with syntax highlighting, error detection, and smart folding. Perfect for developers, data analysts, API testing, and more.</p>
      </div>
    </div>

    <!-- FAQ Section -->
    <div class="faq-section">
      <div class="section-header">
        <h2>{t.faqTitle}</h2>
        <p>{t.faqSubtitle}</p>
      </div>
      <div class="faq-grid">
        <div class="faq-item">
          <h3>{t.faq1Question}</h3>
          <p>{t.faq1Answer}</p>
        </div>
        <div class="faq-item">
          <h3>{t.faq2Question}</h3>
          <p>{t.faq2Answer}</p>
        </div>
        <div class="faq-item">
          <h3>{t.faq3Question}</h3>
          <p>{t.faq3Answer}</p>
        </div>
        <div class="faq-item">
          <h3>{t.faq4Question}</h3>
          <p>{t.faq4Answer}</p>
        </div>
        <div class="faq-item">
          <h3>{t.faq5Question}</h3>
          <p>{t.faq5Answer}</p>
        </div>
        <div class="faq-item">
          <h3>{t.faq6Question}</h3>
          <p>{t.faq6Answer}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- FAQPage Schema for GEO -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Is my data secure?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! All data processing happens locally in your browser. We never send your data to any server."
        }
      },
      {
        "@type": "Question",
        "name": "What file formats are supported?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "We support JSON, URL parameters, XML, and YAML. Simply paste your data and we'll automatically detect the format."
        }
      },
      {
        "@type": "Question",
        "name": "Can I extract specific fields from JSON?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! Use the extraction function field to write JavaScript functions like 'obj => obj.name' to extract specific data."
        }
      },
      {
        "@type": "Question",
        "name": "Is this tool free to use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, this tool is completely free with no limitations. Enjoy!"
        }
      },
      {
        "@type": "Question",
        "name": "Does it work offline?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Once loaded, the tool works completely offline. No internet connection required."
        }
      },
      {
        "@type": "Question",
        "name": "Can I use this on mobile?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! The tool is fully responsive and works great on mobile devices and tablets."
        }
      }
    ]
  })} />

  <!-- HowTo Schema for GEO -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to Format and Validate JSON",
    "description": "Learn how to format, validate, and convert JSON data using our free online JSON viewer tool.",
    "step": [
      {
        "@type": "HowToStep",
        "name": "Paste Your JSON Data",
        "text": "Paste your JSON, URL parameters, XML, or YAML data into the input editor.",
        "image": "https://tojsons.com/step1.png"
      },
      {
        "@type": "HowToStep",
        "name": "Automatic Format Detection",
        "text": "The tool automatically detects your input format and converts it to JSON."
      },
      {
        "@type": "HowToStep",
        "name": "View Formatted JSON",
        "text": "See your beautifully formatted JSON with syntax highlighting and line numbers."
      },
      {
        "@type": "HowToStep",
        "name": "Validate JSON",
        "text": "Any JSON errors are highlighted with specific line numbers and error messages."
      },
      {
        "@type": "HowToStep",
        "name": "Extract or Convert",
        "text": "Use field extraction, convert to XML/YAML/TypeScript, or compress/copy the result."
      }
    ],
    "tool": [
      {
        "@type": "HowToTool",
        "name": "JSON Viewer Online"
      }
    ]
  })} />
</BaseLayout>

<style>
  :root {
    --diff-red-opacity: 239, 68, 68;
    --diff-green-opacity: 34, 197, 94;
    --diff-yellow-opacity: 234, 179, 8;
  }

  .json-formatter-container {
    max-width: 1800px;
    margin: 0 auto;
    padding: 8px;
    height: calc(100vh - var(--sidebar-height, 40px));
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
  }

  /* ‰∏ªÂ∑•‰ΩúÂå∫ - Â∑¶Âè≥Â∏ÉÂ±Ä */
  .editor-workspace {
    display: flex;
    gap: 0;
    flex: 1;
    min-height: 0;
    overflow: hidden;
  }

  /* Â∑¶‰æßËæìÂÖ•Âå∫Âüü */
  .input-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
    min-width: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    margin: 0 auto;
    max-width: 75%;
  }

  /* ÂΩìËæìÂá∫Âå∫ÂüüÂ±ïÂºÄÊó∂ÔºåË∞ÉÊï¥Â∏ÉÂ±Ä */
  .output-area.expanded {
    flex: 1;
    width: 50%;
    opacity: 1;
    border-left: 1px solid #e5e7eb;
    padding-left: 0;
  }

  /* ÂΩìËæìÂá∫Âå∫ÂüüÂ±ïÂºÄÊó∂ÔºåËæìÂÖ•Âå∫Âüü‰πüË∞ÉÊï¥‰∏∫50% */
  .editor-workspace:has(.output-area.expanded) .input-area {
    flex: 1;
    max-width: 50%;
    margin: 0;
  }

  .input-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .section-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    flex-shrink: 0;
  }

  /* H1Ê†áÁ≠æÊ†∑ÂºèÈáçÁΩÆÔºå‰øùÊåÅÂ∏ÉÂ±Ä‰∏ÄËá¥ */
  h1.section-label {
    margin: 0;
    padding: 4px 0 6px 0;
    font-size: 1rem;
    font-weight: 700;
    color: #0f172a;
    flex-shrink: 0;
    display: block;
  }

  h2.section-label {
    margin: 0;
    padding: 0;
    font-size: 0.875rem;
    font-weight: 600;
    margin-top: 10px;
  }

  /* Section Header Row - Ê†áÈ¢òÂíåÊèêÁ§∫Âú®Âêå‰∏ÄË°å */
  .section-header-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 8px;
    flex-wrap: wrap;
  }

  /* Editor Hint Inline - ÂÜÖËÅîÊèêÁ§∫ */
  .editor-hint-inline {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(37, 99, 235, 0.08) 100%);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 6px;
    padding: 4px 10px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    flex-shrink: 0;
  }

  .editor-hint-inline:hover {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(37, 99, 235, 0.12) 100%);
    border-color: rgba(59, 130, 246, 0.3);
    box-shadow: 0 1px 4px rgba(59, 130, 246, 0.1);
  }

  .editor-hint-inline.hint-hidden {
    opacity: 0;
    transform: translateX(4px);
    pointer-events: none;
  }

  .editor-hint-inline .hint-icon {
    font-size: 14px;
    flex-shrink: 0;
    animation: sparkle 2s ease-in-out infinite;
  }

  @keyframes sparkle {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.15); }
  }

  .editor-hint-inline .hint-text {
    font-size: 0.75rem;
    font-weight: 600;
    color: #3b82f6;
    white-space: nowrap;
  }

  /* ÁßªÂä®Á´Ø‰ºòÂåñ */
  @media (max-width: 768px) {
    .section-header-row {
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
    }

    .editor-hint-inline {
      padding: 3px 8px;
    }

    .editor-hint-inline .hint-icon {
      font-size: 12px;
    }

    .editor-hint-inline .hint-text {
      font-size: 0.7rem;
    }
  }

  /* ÊØîËæÉÊ®°Âºè‰∏ãÁöÑÊ†áÈ¢ò‰ºòÂåñ */
  @media (max-width: 768px) {
    .editor-hint {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
      padding: 8px 10px;
    }

    .hint-icon {
      font-size: 16px;
    }

    .hint-title {
      font-size: 0.8rem;
    }

    .hint-description {
      font-size: 0.7rem;
    }

    .hint-features {
      gap: 4px;
    }

    .hint-badge {
      font-size: 0.65rem;
      padding: 2px 6px;
    }

    .hint-security {
      font-size: 0.65rem;
      padding: 3px 8px;
      align-self: flex-start;
    }
  }

  /* ÊØîËæÉÊ®°Âºè‰∏ãÁöÑÊ†áÈ¢ò‰ºòÂåñ */
  .editors-wrapper.compare-mode h1.section-label,
  .editors-wrapper.compare-mode h2.section-label {
    margin-top: 0;
    margin-bottom: 6px;
    text-align: center;
  }

  /* ÊØîËæÉÊ®°Âºè‰∏ãÊ∑ªÂä†ËæπÊ°ÜÂå∫ÂàÜ‰∏§‰∏™ÁºñËæëÂô® */
  .editors-wrapper.compare-mode .input-section:first-child .input-editor-wrapper {
    border: 2px solid #3b82f6;
  }

  .editors-wrapper.compare-mode .compare-editor .input-editor-wrapper {
    border: 2px solid #10b981;
  }

  /* ÊØîËæÉÊ®°ÂºèÊ†∑Âºè */
  .compare-editor {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .compare-editor.hidden {
    display: none;
  }

  /* ÁºñËæëÂô®ÂåÖË£ÖÂÆπÂô® */
  .editors-wrapper {
    display: flex;
    flex: 1;
    gap: 0;
    min-height: 0;
  }

  /* ÊØîËæÉÊ®°Âºè‰∏ãÁöÑÂ∏ÉÂ±ÄË∞ÉÊï¥ */
  .editors-wrapper.compare-mode {
    gap: 10px;
  }

  .editors-wrapper.compare-mode .input-section {
    flex: 1;
    min-height: 0;
    min-width: 0;
  }

  .editors-wrapper.compare-mode .compare-editor {
    flex: 1;
    min-height: 0;
    min-width: 0;
  }

  /* ÁßªÂä®Á´ØÊØîËæÉÊ®°Âºè‰øùÊåÅ‰∏ä‰∏ãÁªìÊûÑ */
  @media (max-width: 768px) {
    .editors-wrapper.compare-mode {
      flex-direction: column;
    }
  }

  /* DiffÁªìÊûúÊ†∑Âºè */
  .diff-result {
    padding: 16px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 13px;
    line-height: 1.6;
    overflow: auto;
  }

  .diff-added {
    background-color: #d4edda;
    color: #155724;
    padding: 4px 8px;
    margin: 2px 0;
    border-left: 3px solid #28a745;
  }

  .diff-removed {
    background-color: #f8d7da;
    color: #721c24;
    padding: 4px 8px;
    margin: 2px 0;
    border-left: 3px solid #dc3545;
    text-decoration: line-through;
  }

  .diff-changed {
    background-color: #fff3cd;
    color: #856404;
    padding: 4px 8px;
    margin: 2px 0;
    border-left: 3px solid #ffc107;
  }

  .diff-unchanged {
    color: #6c757d;
    padding: 4px 8px;
    margin: 2px 0;
  }

  /* Monaco EditorÂ∑ÆÂºÇÈ´ò‰∫ÆË£ÖÈ•∞ - Â¢ûÂº∫ËßÜËßâÊïàÊûú */
  .monaco-editor .diff-removed {
    background-color: rgba(239, 68, 68, 0.25) !important;
    border-left: 4px solid #ef4444 !important;
    position: relative !important;
  }

  .monaco-editor .diff-removed::before {
    content: '' !important;
    position: absolute !important;
    left: 0 !important;
    top: 0 !important;
    bottom: 0 !important;
    width: 3px !important;
    background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%) !important;
    box-shadow: 0 0 8px rgba(239, 68, 68, 0.4) !important;
  }

  .monaco-editor .diff-added {
    background-color: rgba(34, 197, 94, 0.25) !important;
    border-left: 4px solid #22c55e !important;
    position: relative !important;
  }

  .monaco-editor .diff-added::before {
    content: '' !important;
    position: absolute !important;
    left: 0 !important;
    top: 0 !important;
    bottom: 0 !important;
    width: 3px !important;
    background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%) !important;
    box-shadow: 0 0 8px rgba(34, 197, 94, 0.4) !important;
  }

  .monaco-editor .diff-changed {
    background-color: rgba(234, 179, 8, 0.25) !important;
    border-left: 4px solid #eab308 !important;
    position: relative !important;
  }

  .monaco-editor .diff-changed::before {
    content: '' !important;
    position: absolute !important;
    left: 0 !important;
    top: 0 !important;
    bottom: 0 !important;
    width: 3px !important;
    background: linear-gradient(180deg, #eab308 0%, #ca8a04 100%) !important;
    box-shadow: 0 0 8px rgba(234, 179, 8, 0.4) !important;
  }

  /* Â∑ÆÂºÇÈ´ò‰∫ÆË£ÖÈ•∞Á±ª - Áî®‰∫éMonaco EditorÁöÑdeltaDecorations */
  .diff-removed-decoration {
    background-color: rgba(239, 68, 68, 0.25) !important;
    border-left: 4px solid #ef4444 !important;
  }

  .diff-added-decoration {
    background-color: rgba(34, 197, 94, 0.25) !important;
    border-left: 4px solid #22c55e !important;
  }

  .diff-changed-decoration {
    background-color: rgba(234, 179, 8, 0.25) !important;
    border-left: 4px solid #eab308 !important;
  }

  /* Â¢ûÂº∫Â∑ÆÂºÇÈ´ò‰∫ÆÁöÑÂèØËßÅÊÄß */
  .monaco-editor .diff-removed-decoration,
  .monaco-editor .diff-added-decoration,
  .monaco-editor .diff-changed-decoration {
    position: relative !important;
    transition: all 0.2s ease !important;
  }

  .monaco-editor .diff-removed-decoration:hover,
  .monaco-editor .diff-added-decoration:hover,
  .monaco-editor .diff-changed-decoration:hover {
    filter: brightness(0.9) !important;
  }

  /* ÁßªÂä®Á´ØÂ∑ÆÂºÇÈ´ò‰∫ÆÂ¢ûÂº∫ */
  @media (max-width: 768px) {
    .monaco-editor .diff-removed-decoration {
      background-color: rgba(var(--diff-red-opacity), 0.35) !important;
      border-left: 4px solid #ef4444 !important;
      border-right: 2px solid rgba(239, 68, 68, 0.3) !important;
    }

    .monaco-editor .diff-added-decoration {
      background-color: rgba(var(--diff-green-opacity), 0.35) !important;
      border-left: 4px solid #22c55e !important;
      border-right: 2px solid rgba(34, 197, 94, 0.3) !important;
    }

    .monaco-editor .diff-changed-decoration {
      background-color: rgba(var(--diff-yellow-opacity), 0.35) !important;
      border-left: 4px solid #eab308 !important;
      border-right: 2px solid rgba(234, 179, 8, 0.3) !important;
    }

    /* ÁßªÂä®Á´ØÂ∑ÆÂºÇÈ´ò‰∫ÆÂä®Áîª */
    .monaco-editor .diff-removed-decoration,
    .monaco-editor .diff-added-decoration,
    .monaco-editor .diff-changed-decoration {
      animation: diffPulse 2s ease-in-out;
    }

    @keyframes diffPulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }
  }

  .input-editor-wrapper {
    display: flex;
    border: 1px solid #e1e4e8;
    border-radius: 8px;
    overflow: hidden;
    flex: 1;
    min-height: 0;
    position: relative;
  }

  .monaco-editor-container {
    flex: 1;
    width: 100%;
    height: 100%;
    min-height: 400px;
    position: relative;
  }

  /* ÁæéÂåñMonaco EditorÊäòÂè†ÊåâÈíÆ */
  .monaco-editor .codicon-add-selection,
  .monaco-editor .codicon-chevron-right,
  .monaco-editor .folding-icon::before,
  .monaco-editor .codicon-folding-expanded,
  .monaco-editor .codicon-folding-collapsed {
    content: '' !important;
  }

  /* Ëá™ÂÆö‰πâÊäòÂè†ÊåâÈíÆÊ†∑Âºè */
  .monaco-editor .folding-icon {
    width: 16px !important;
    height: 16px !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
  }

  /* Â±ïÂºÄÁä∂ÊÄÅÁöÑÊäòÂè†ÊåâÈíÆ */
  .monaco-editor .folding-icon.collapsed::after,
  .monaco-editor .codicon-folding-collapsed::after {
    content: '‚ñ∂' !important;
    font-size: 10px !important;
    color: #6b7280 !important;
    display: inline-block !important;
    margin-left: 1px !important;
  }

  /* ÊäòÂè†Áä∂ÊÄÅÁöÑÊäòÂè†ÊåâÈíÆ */
  .monaco-editor .folding-icon:not(.collapsed)::after,
  .monaco-editor .codicon-folding-expanded::after {
    content: '‚ñº' !important;
    font-size: 9px !important;
    color: #6b7280 !important;
    display: inline-block !important;
  }

  /* ÊäòÂè†ÊåâÈíÆhoverÊïàÊûú */
  .monaco-editor .folding-icon:hover::after {
    color: #3b82f6 !important;
  }

  /* JSON Ê†°È™åÈîôËØØÊèêÁ§∫ */
  .validation-error {
    padding: 12px 16px;
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    border: 1px solid #fecaca;
    border-radius: 6px;
    margin-bottom: 10px;
    font-size: 0.875rem;
    color: #991b1b;
    border-left: 4px solid #ef4444;
    display: none;
    animation: slideDown 0.3s ease-out;
  }

  .validation-error {
    padding: 12px 16px;
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    border: 1px solid #fecaca;
    border-radius: 6px;
    margin-bottom: 10px;
    font-size: 0.875rem;
    color: #991b1b;
    border-left: 4px solid #ef4444;
    display: none;
    animation: slideDown 0.3s ease-out;
  }

  .validation-error.show {
    display: block;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ÊèêÂèñÂå∫Âüü */
  .extraction-section {
    padding: 10px 12px;
    background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f5 100%);
    border-radius: 6px;
    border: 1px solid #e9ecef;
  }

  .extraction-controls {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .extraction-controls label {
    font-weight: 600;
    color: var(--text-color);
    white-space: nowrap;
    font-size: 0.85rem;
  }

  .extraction-controls input {
    flex: 1;
    min-width: 200px;
    padding: 6px 10px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    font-size: 13px;
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: all 0.2s;
  }

  .extraction-controls input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .extraction-controls button {
    padding: 6px 14px;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
    transition: all 0.2s;
  }

  #apply-extract {
    font-size: 13px;
  }

  .extraction-controls button:hover {
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    transform: translateY(-1px);
  }

  #clear-extract-fn {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    font-size: 13px;
  }

  #clear-extract-fn:hover {
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
  }

/* ÊåâÈíÆÁªÑ */
  .output-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .output-controls button {
    padding: 6px 10px;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 11px;
    font-weight: 500;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    flex: 0 0 auto;
    min-width: fit-content;
  }

  .output-controls select {
    padding: 6px 10px;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 11px;
    font-weight: 500;
    transition: all 0.2s;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  .output-controls select option {
    background: white;
    color: #1f2937;
    padding: 6px 10px;
  }

  .output-controls select:hover {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    transform: translateY(-1px);
  }

  .output-controls button:hover {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
    transform: translateY(-1px);
  }

  /* ÁßªÂä®Á´ØÊåâÈíÆ‰∫§‰∫í‰ºòÂåñ */
  .output-controls button:active {
    transform: translateY(0) scale(0.98);
    transition: all 0.1s;
  }

  .output-controls select:active {
    transform: translateY(0) scale(0.98);
    transition: all 0.1s;
  }

  #clear-btn {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
  }

  #clear-btn:hover {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important;
    box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
  }

  /* ÁßªÂä®Á´ØÁâπÊÆäÊåâÈíÆÊ†∑Âºè */
  #apply-extract {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  }

  #apply-extract:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
  }

  /* ÁßªÂä®Á´ØÊåâÈíÆÁªÑÂ∏ÉÂ±Ä‰ºòÂåñ */
  @media (max-width: 768px) {
    .output-controls {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-auto-flow: dense;
      gap: 4px;
    }

    .output-controls button,
    .output-controls select {
      min-height: 36px;
      font-size: 12px;
      padding: 8px 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ÊúÄÂêé‰∏â‰∏™ÊåâÈíÆÔºàÊ∏ÖÁ©∫„ÄÅÂéÜÂè≤ËÆ∞ÂΩï„ÄÅÂ≠ó‰ΩìÂ§ßÂ∞èÈÄâÊã©ÔºâÂú®ÁßªÂä®Á´ØÂ∞èÂ±èÂπïÊÉÖÂÜµ‰∏ãÂπ∂ÊéíÊòæÁ§∫ */
    #clear-btn,
    #history-btn,
    #font-size-select {
      grid-column: auto;
      grid-row: span 1;
      flex: 1;
      width: auto;
      min-width: 0;
    }
  }

  /* ‰∏≠ÊñáÈ°µÈù¢ÊåâÈíÆÂ∏ÉÂ±Ä‰ºòÂåñ - ÈïøÊñáÂ≠óÈúÄË¶ÅÊõ¥Â§öÁ©∫Èó¥ */
  [lang="zh-CN"] .output-controls {
    grid-template-columns: repeat(2, 1fr);
  }

  [lang="zh-CN"] .output-controls button {
    font-size: 11px;
    padding: 6px 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  [lang="zh-CN"] #history-btn {
    grid-column: span 1;
  }

  @media (max-width: 480px) {
    .output-controls {
      gap: 3px;
    }

    .output-controls button {
      min-height: 32px;
      font-size: 11px;
      padding: 4px 6px;
    }

    .output-controls select {
      min-height: 32px;
      font-size: 11px;
      padding: 4px 6px;
    }
  }

  /* ‰∏≠ÊñáÈ°µÈù¢Ë∂ÖÂ∞èÂ±èÂπï‰ºòÂåñ */
  @media (max-width: 480px) {
    [lang="zh-CN"] .output-controls button {
      font-size: 10px;
      padding: 4px 6px;
    }
  }

  /* Âè≥‰æßËæìÂá∫Âå∫Âüü */
  .output-area {
    width: 0;
    opacity: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border-left: 1px solid transparent;
  }

  .output-area.expanded {
    width: 50%;
    opacity: 1;
    border-left: 1px solid #e5e7eb;
    padding-left: 0;
  }

  .output-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f5 100%);
    border-radius: 6px 6px 0 0;
    border: 1px solid #e9ecef;
    border-bottom: none;
  }

  .output-title {
    font-size: 0.85rem;
    font-weight: 600;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .close-output-btn {
    background: none;
    border: none;
    font-size: 24px;
    color: #9ca3af;
    cursor: pointer;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s;
    line-height: 1;
  }

  .close-output-btn:hover {
    background: rgba(239, 68, 68, 0.1);
    color: #dc2626;
  }

  /* ËæìÂá∫ÂÜÖÂÆπÂå∫ÂüüÔºå‰∏éËæìÂÖ•Ê°ÜÁõ∏ÂêåÊ†∑Âºè */
  .output-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .output-editor-wrapper {
    display: flex;
    border: 1px solid #e1e4e8;
    border-radius: 0 0 8px 8px;
    overflow: hidden;
    flex: 1;
    background: linear-gradient(to bottom, #fafbfc 0%, #f5f6f8 100%);
  }

  #output-json {
    flex: 1;
    padding: 12px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 13px;
    line-height: 1.5;
    overflow: auto;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
    min-height: 0;
  }

  /* JSONÊ†ëÂΩ¢Êü•ÁúãÂô®Ê†∑Âºè */
  .json-root {
    padding: 5px 0;
  }

  .json-bracket {
    padding: 0 5px;
  }

  .json-node {
    margin-left: 18px;
  }

  .json-property {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 2px 0;
    border-radius: 3px;
    transition: background 0.1s;
  }

  .json-property:hover {
    background: rgba(59, 130, 246, 0.05);
  }

  .json-toggle {
    display: inline-block;
    width: 14px;
    height: 14px;
    text-align: center;
    line-height: 12px;
    cursor: pointer;
    border: 1px solid #d1d5db;
    border-radius: 3px;
    margin-right: 6px;
    font-size: 10px;
    user-select: none;
    background: #fff;
    color: #6b7280;
    transition: all 0.15s;
  }

  .json-toggle:hover {
    border-color: #3b82f6;
    color: #3b82f6;
  }

  .json-key {
    color: #7c3aed;
    margin-right: 6px;
    font-weight: 500;
  }

  .json-separator {
    margin-right: 6px;
    color: #94a3b8;
  }

  .json-value-string {
    color: #059669;
  }

  .json-value-number {
    color: #dc2626;
  }

  .json-value-boolean {
    color: #2563eb;
  }

  .json-value-null {
    color: #9ca3af;
  }

  .json-value-object,
  .json-value-array {
    color: #1f2937;
  }

  .collapsed > .json-node {
    display: none;
  }

  /* Tutorial Section */
  .tutorial-section {
    max-width: 1800px;
    margin: 60px auto 0;
    padding: 40px 20px;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .tutorial-section .section-header,
  .faq-section .section-header {
    text-align: center;
    margin-bottom: 40px;
  }

  .tutorial-section .section-header h2,
  .faq-section .section-header h2 {
    font-size: 2.5rem;
    font-weight: 800;
    color: #1e293b;
    margin-bottom: 12px;
    background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .tutorial-section .section-header p,
  .faq-section .section-header p {
    font-size: 1.1rem;
    color: #64748b;
  }

  .tutorial-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 32px;
  }

  .tutorial-step {
    display: flex;
    gap: 20px;
    align-items: flex-start;
    background: white;
    padding: 24px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-left: 4px solid transparent;
  }

  .tutorial-step:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    border-left-color: #3b82f6;
  }

  .step-number {
    flex-shrink: 0;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.125rem;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }

  .step-content {
    flex: 1;
  }

  .step-content h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #0f172a;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .step-content p {
    color: #475569;
    line-height: 1.7;
    margin-bottom: 12px;
    font-size: 0.9375rem;
  }

  .step-content p:last-child {
    margin-bottom: 0;
  }

  .step-example {
    background: #1e293b;
    border-radius: 8px;
    padding: 16px;
    margin: 12px 0;
    overflow-x: auto;
  }

  .step-example code {
    color: #e2e8f0;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.875rem;
    line-height: 1.6;
    white-space: pre;
  }

  .example-desc {
    color: #64748b;
    font-size: 0.875rem;
    font-style: italic;
    margin-top: 8px;
  }

  .tip {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border-left: 4px solid #f59e0b;
    padding: 12px 16px;
    border-radius: 6px;
    margin-top: 12px;
    font-size: 0.875rem;
    color: #92400e;
  }

  .privacy-note {
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    border-left: 4px solid #3b82f6;
    padding: 12px 16px;
    border-radius: 6px;
    margin-top: 12px;
    font-size: 0.875rem;
    color: #1e40af;
  }

  .action-list {
    list-style: none;
    padding: 0;
    margin: 12px 0 0 0;
  }

  .action-list li {
    padding: 8px 0;
    padding-left: 24px;
    position: relative;
    color: #475569;
    font-size: 0.9375rem;
    line-height: 1.6;
  }

  .action-list li::before {
    content: '‚úì';
    position: absolute;
    left: 0;
    color: #3b82f6;
    font-weight: 700;
  }

  .action-list li strong {
    color: #0f172a;
    font-weight: 600;
  }

  /* Features Section - ÂàõÊÑèÊ∏êÂèòÊïàÊûú */
  .features-section {
    max-width: 1800px;
    margin: 60px auto 0;
    padding: 60px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    position: relative;
    overflow: hidden;
  }

  .features-section::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    animation: rotate 20s linear infinite;
  }

  @keyframes rotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  .features-section .section-header {
    text-align: center;
    margin-bottom: 50px;
    position: relative;
    z-index: 1;
  }

  .features-section .section-header h2 {
    font-size: 2.5rem;
    font-weight: 800;
    color: white;
    margin-bottom: 12px;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }

  .features-section .section-header p {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.9);
  }

  .features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 30px;
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
  }

  .feature-item {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 0;
    position: relative;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }

  .feature-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .feature-item:hover::before {
    transform: scaleX(1);
  }

  .feature-item:hover {
    transform: translateY(-8px) rotateX(2deg);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
  }

  .feature-number {
    font-size: 4rem;
    font-weight: 900;
    color: rgba(102, 126, 234, 0.08);
    position: absolute;
    top: -10px;
    right: 10px;
    line-height: 1;
    transition: all 0.4s ease;
  }

  .feature-item:hover .feature-number {
    color: rgba(102, 126, 234, 0.15);
    transform: scale(1.1);
  }

  .feature-content {
    padding: 32px;
    position: relative;
    z-index: 1;
  }

  .feature-icon {
    font-size: 3rem;
    margin-bottom: 20px;
    display: inline-block;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
  }

  .feature-item:hover .feature-icon {
    transform: scale(1.2) rotate(5deg);
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
  }

  .feature-content h3 {
    font-size: 1.35rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 12px;
    transition: color 0.3s ease;
  }

  .feature-item:hover .feature-content h3 {
    color: #667eea;
  }

  .feature-content p {
    color: #64748b;
    line-height: 1.7;
    font-size: 0.95rem;
  }

  /* Supported Formats Section */
  .supported-formats-section {
    max-width: 1800px;
    margin: 60px auto 0;
    padding: 50px 20px;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
  }

  .supported-formats-section .section-header {
    text-align: center;
    margin-bottom: 45px;
  }

  .supported-formats-section .section-header h2 {
    font-size: 2.2rem;
    font-weight: 800;
    color: #0f172a;
    margin-bottom: 12px;
    background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .supported-formats-section .section-header p {
    font-size: 1.1rem;
    color: #64748b;
  }

  .formats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 24px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .format-category {
    background: white;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid #e0f2fe;
  }

  .format-category:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(14, 165, 233, 0.15);
    border-color: #0ea5e9;
  }

  .format-category h3 {
    font-size: 1.2rem;
    font-weight: 700;
    color: #0f172a;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e0f2fe;
  }

  .format-category ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .format-category li {
    padding: 8px 0;
    padding-left: 24px;
    position: relative;
    color: #475569;
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .format-category li::before {
    content: '‚úì';
    position: absolute;
    left: 0;
    color: #0ea5e9;
    font-weight: 700;
  }

  .formats-note {
    max-width: 900px;
    margin: 35px auto 0;
    padding: 18px 24px;
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    border-left: 4px solid #3b82f6;
    border-radius: 8px;
    font-size: 0.95rem;
    color: #1e40af;
    line-height: 1.7;
  }

  .formats-note strong {
    font-weight: 700;
    color: #1e3a8a;
  }

  /* FAQ Section - 2ÂàóÂ±ïÂºÄÊ†∑Âºè */
  .faq-section {
    max-width: 1800px;
    margin: 60px auto 40px;
    padding: 40px 20px;
    background: transparent;
    border-radius: 0;
    border: none;
  }

  .faq-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 32px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .faq-item {
    padding: 0;
    background: transparent;
    border-radius: 0;
    border: none;
    border-left: 3px solid #3b82f6;
    padding-left: 20px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .faq-item:hover {
    border-left-color: #2563eb;
    padding-left: 24px;
  }

  .faq-item h3 {
    font-size: 1.15rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 12px;
  }

  .faq-item p {
    color: #64748b;
    line-height: 1.7;
    font-size: 0.95rem;
  }

/* ÂìçÂ∫îÂºèËÆæËÆ° */
  @media (max-width: 1200px) {
    .output-area.expanded {
      width: 60%;
    }
  }

  @media (max-width: 768px) {
    .json-formatter-container {
      padding: 6px;
      height: calc(100vh - var(--sidebar-height, 40px));
      flex-shrink: 0;
    }

    .editor-workspace {
      flex-direction: column;
    }

    .input-area {
      gap: 8px;
      min-height: 300px;
      max-width: 100%;
    }

    .monaco-editor-container {
      min-height: 250px;
    }

    /* ÁßªÂä®Á´ØÊØîËæÉÊ®°Âºè‰ºòÂåñ */
    .editors-wrapper.compare-mode {
      flex-direction: column;
      gap: 8px;
    }

    .editors-wrapper.compare-mode .input-section {
      min-height: 200px;
    }

    /* ÁßªÂä®Á´ØÁºñËæëÂô®ÂÆπÂô®‰ºòÂåñ */
    .input-editor-wrapper {
      min-height: 200px;
    }

    .extraction-controls {
      flex-wrap: wrap;
      gap: 6px;
    }

    .extraction-controls input {
      min-width: 100%;
      margin-bottom: 6px;
    }

    .extraction-controls label {
      width: 100%;
      margin-bottom: 4px;
    }

    .json-input {
      min-height: 200px;
    }

    .output-controls {
      gap: 4px;
      flex-wrap: wrap;
    }

    .output-controls button {
      padding: 8px 12px;
      font-size: 12px;
      flex: 1;
      min-width: 70px;
      height: 36px;
    }

    .output-controls select {
      flex: 1;
      min-width: 90px;
      height: 36px;
      padding: 8px 12px;
    }

    .output-area.expanded {
      width: 100%;
      border-left: none;
      padding-left: 0;
      margin-top: 12px;
      height: 350px;
    }

    /* ÁßªÂä®Á´ØMonaco Editor‰ºòÂåñ */
    .monaco-editor-container {
      min-height: 200px;
    }

    /* ÁßªÂä®Á´ØÂ∑ÆÂºÇÈ´ò‰∫Æ‰ºòÂåñ */
    .monaco-editor .diff-removed-decoration,
    .monaco-editor .diff-added-decoration,
    .monaco-editor .diff-changed-decoration {
      background-color: rgba(var(--diff-opacity), 0.3) !important;
      border-left-width: 3px !important;
    }

    /* ÁßªÂä®Á´ØÁºñËæëÂô®Ëß¶Êë∏‰ºòÂåñ */
    .monaco-editor {
      touch-action: pan-y;
    }

    .monaco-editor .margin {
      touch-action: none;
    }

    /* ÁßªÂä®Á´ØÊèêÂèñÂå∫Âüü‰ºòÂåñ */
    .extraction-section {
      padding: 8px;
    }

    .extraction-controls {
      gap: 8px;
    }

    .extraction-controls input {
      padding: 8px 12px;
      font-size: 14px;
      min-height: 40px;
    }

    .extraction-controls button {
      min-height: 40px;
      padding: 8px 16px;
      font-size: 14px;
    }

    /* Tutorial section ÁßªÂä®Á´Ø‰ºòÂåñ */
    .tutorial-step {
      flex-direction: column;
      padding: 16px;
    }

    .step-number {
      margin-bottom: 12px;
    }

    .section-header {
      padding: 20px 12px;
    }

    .section-header h2 {
      font-size: 1.5rem;
    }

    /* Features ÁßªÂä®Á´Ø‰ºòÂåñ */
    .features-grid {
      grid-template-columns: 1fr;
      gap: 16px;
      padding: 0 12px;
    }

    /* Supported Formats ÁßªÂä®Á´Ø‰ºòÂåñ */
    .formats-grid {
      grid-template-columns: 1fr;
      gap: 16px;
      padding: 0 12px;
    }

    .format-category {
      padding: 18px;
    }

    .formats-note {
      margin: 25px 12px 0;
      padding: 14px 18px;
      font-size: 0.9rem;
    }

    /* FAQ ÁßªÂä®Á´Ø‰ºòÂåñ */
    .faq-grid {
      grid-template-columns: 1fr;
      gap: 24px;
      padding: 0 12px;
    }

    .faq-item {
      border-left-width: 2px;
      padding-left: 16px;
    }

    .faq-item:hover {
      padding-left: 18px;
    }
  }

  @media (max-width: 480px) {
    .json-formatter-container {
      padding: 4px;
    }

    .input-area {
      gap: 6px;
    }

    .output-controls {
      gap: 3px;
    }

    .output-controls button {
      flex: 1;
      min-width: 0;
      padding: 6px 8px;
      font-size: 11px;
      height: 32px;
    }

    .output-controls select {
      height: 32px;
      padding: 6px 8px;
      font-size: 11px;
    }

    .json-action-group {
      flex: 1;
    }

    .json-input {
      min-height: 150px;
      font-size: 12px;
    }

    .extraction-section {
      padding: 6px;
    }

    .monaco-editor-container {
      min-height: 150px;
    }

    /* Ë∂ÖÂ∞èÂ±èÂπïÊØîËæÉÊ®°Âºè‰ºòÂåñ */
    .editors-wrapper.compare-mode .input-section {
      min-height: 150px;
    }

    .input-editor-wrapper {
      min-height: 150px;
    }
  }

  /* ÁßªÂä®Á´ØÊ®™Â±è‰ºòÂåñ */
  @media (max-width: 768px) and (orientation: landscape) {
    .json-formatter-container {
      height: calc(100vh - 20px);
    }

    .input-area {
      min-height: 200px;
    }

    .monaco-editor-container {
      min-height: 180px;
    }

    .editors-wrapper.compare-mode .input-section {
      min-height: 160px;
    }

    .output-area.expanded {
      height: 250px;
    }
  }
</style>

<script type="module">
  // ÈÖçÁΩÆ Monaco Editor ÁöÑËµÑÊ∫êË∑ØÂæÑ
  window.MonacoEnvironment = {
    getWorkerUrl: function (workerId, label) {
      return `https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/base/workers/${label === 'json' ? 'json.worker' : 'editor.worker'}.js`;
    }
  };

  // ‰ΩøÁî® CDN ÂØºÂÖ• Monaco Editor
  import * as monaco from 'https://esm.sh/monaco-editor@0.45.0';

  // ÈÖçÁΩÆ Monaco Editor
  monaco.editor.setTheme('vs');

  // ÂÖ®Â±ÄÂèòÈáè
  let editor = null;
  let outputEditor = null;
  let compareEditor = null;
  let translations = {};
  let isCompareMode = false;
  let leftDecorations = [];
  let rightDecorations = [];

  // DOMÂä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
  document.addEventListener('DOMContentLoaded', () => {
    // ‰ªéDOMÂÖÉÁ¥†Ëé∑ÂèñÁøªËØëÊñáÊú¨
    const container = document.querySelector('.json-formatter-container');
    translations = {
      enterExtractionFn: container.dataset.enterExtractionFn,
      enterData: container.dataset.enterData,
      extractionError: container.dataset.extractionError,
      parsingError: container.dataset.parsingError,
      compressSuccess: container.dataset.compressSuccess,
      escapeSuccess: container.dataset.escapeSuccess,
      xmlSuccess: container.dataset.xmlSuccess,
      tsSuccess: container.dataset.tsSuccess,
      csvSuccess: container.dataset.csvSuccess,
      excelSuccess: container.dataset.excelSuccess
    };

    // ÂàùÂßãÂåñ Monaco Editor
    initializeMonacoEditor();

    initializeJsonFormatter();
  });

  // ÂàùÂßãÂåñ Monaco Editor
  function initializeMonacoEditor() {
    const container = document.getElementById('monaco-editor-container');
    if (!container) {
      console.error('Monaco Editor container not found');
      return;
    }

    // Á≠âÂæÖÈ°µÈù¢ÂÆåÂÖ®Ê∏≤ÊüìÔºåÂåÖÊã¨ CSS Ê†∑ÂºèÂ∫îÁî®
    // ‰ΩøÁî®ÂèåÈáç requestAnimationFrame Á°Æ‰øùÊµèËßàÂô®ÂÆåÊàêÂ∏ÉÂ±ÄËÆ°ÁÆó
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        // Á°Æ‰øùÂÆπÂô®ÊúâÊ≠£Á°ÆÁöÑÂ∞∫ÂØ∏
        console.log('Container dimensions:', {
          width: container.offsetWidth,
          height: container.offsetHeight
        });

        // Â¶ÇÊûúÂÆπÂô®Â∞∫ÂØ∏ËøòÊòØÂºÇÂ∏∏ÔºåÂÜçÂª∂Ëøü‰∏ÄÁÇπ
        if (container.offsetWidth === 0 || container.offsetHeight === 0) {
          setTimeout(() => createEditor(container), 50);
        } else {
          createEditor(container);
        }
      });
    });
  }

  // ÂàõÂª∫ Monaco Editor
  function createEditor(container) {
    // Ëé∑Âèñ‰øùÂ≠òÁöÑÂ≠ó‰ΩìÂ§ßÂ∞è
    const savedFontSize = localStorage.getItem('editorFontSize') || '13';

    // ÂàõÂª∫ËæìÂÖ•ÁºñËæëÂô®
    editor = monaco.editor.create(container, {
      value: '',
      language: 'json',
      theme: 'vs',
      automaticLayout: true,
      fontSize: parseInt(savedFontSize),
      fontFamily: "'Monaco', 'Menlo', 'Ubuntu Mono', monospace",
      lineHeight: 21,
      minimap: { enabled: false },
      scrollBeyondLastLine: false,
      wordWrap: 'off',
      // Ë°åÂè∑ÈÖçÁΩÆ
      lineNumbers: 'on',
      lineNumbersMinChars: 3,
      // ÊäòÂè†ÈÖçÁΩÆ
      folding: true,
      foldingStrategy: 'indentation',
      foldingHighlight: true,
      showFoldingControls: 'always',
      // ÂÖ∂‰ªñÈÖçÁΩÆ
      matchBrackets: 'always',
      autoClosingBrackets: 'always',
      autoClosingQuotes: 'always',
      formatOnPaste: true,
      formatOnType: true,
      tabSize: 2,
      renderLineHighlight: 'all',
      scrollbar: {
        vertical: 'visible',
        horizontal: 'visible'
      },
      padding: { top: 12, bottom: 12 },
      readOnly: false
    });

    console.log('Monaco Editor created successfully');

    // ÂàõÂª∫ËæìÂá∫ÁºñËæëÂô®
    const outputContainer = document.getElementById('output-monaco-container');
    if (outputContainer) {
      outputEditor = monaco.editor.create(outputContainer, {
        value: '',
        language: 'json',
        theme: 'vs',
        automaticLayout: true,
        fontSize: parseInt(savedFontSize),
        fontFamily: "'Monaco', 'Menlo', 'Ubuntu Mono', monospace",
        lineHeight: 21,
        minimap: { enabled: false },
        scrollBeyondLastLine: false,
        wordWrap: 'off',
        lineNumbers: 'on',
        lineNumbersMinChars: 3,
        folding: true,
        foldingStrategy: 'indentation',
        foldingHighlight: true,
        showFoldingControls: 'always',
        matchBrackets: 'always',
        tabSize: 2,
        renderLineHighlight: 'all',
        scrollbar: {
          vertical: 'visible',
          horizontal: 'visible'
        },
        padding: { top: 12, bottom: 12 },
        readOnly: true  // ËæìÂá∫ÁºñËæëÂô®Âè™ËØª
      });
      console.log('Output Monaco Editor created successfully');
    }

    // ÂàõÂª∫ÊØîËæÉÁºñËæëÂô®
    const compareContainer = document.getElementById('monaco-compare-container');
    if (compareContainer) {
      compareEditor = monaco.editor.create(compareContainer, {
        value: '',
        language: 'json',
        theme: 'vs',
        automaticLayout: true,
        fontSize: parseInt(savedFontSize),
        fontFamily: "'Monaco', 'Menlo', 'Ubuntu Mono', monospace",
        lineHeight: 21,
        minimap: { enabled: false },
        scrollBeyondLastLine: false,
        wordWrap: 'off',
        lineNumbers: 'on',
        lineNumbersMinChars: 3,
        folding: true,
        foldingStrategy: 'indentation',
        foldingHighlight: true,
        showFoldingControls: 'always',
        matchBrackets: 'always',
        autoClosingBrackets: 'always',
        autoClosingQuotes: 'always',
        formatOnPaste: true,
        formatOnType: true,
        tabSize: 2,
        renderLineHighlight: 'all',
        scrollbar: {
          vertical: 'visible',
          horizontal: 'visible'
        },
        padding: { top: 12, bottom: 12 },
        readOnly: false
      });
      console.log('Compare Monaco Editor created successfully');

      // ÁõëÂê¨ÊØîËæÉÁºñËæëÂô®ÂÜÖÂÆπÂèòÂåñÔºåËá™Âä®Êõ¥Êñ∞Â∑ÆÂºÇÈ´ò‰∫Æ
      compareEditor.onDidChangeModelContent(() => {
        if (isCompareMode) {
          highlightDifferences();
        }
      });
    }

    // Ë∞ÉËØïÔºöÊ£ÄÊü• DOM ÁªìÊûÑ
    setTimeout(() => {
      const monacoContainer = container.querySelector('.monaco-editor');
      if (monacoContainer) {
        const margin = monacoContainer.querySelector('.margin');
        console.log('Monaco DOM structure:', {
          container: container.offsetWidth,
          monacoEditor: monacoContainer.offsetWidth,
          margin: margin ? margin.offsetWidth : 'NOT FOUND',
          marginVisible: margin ? window.getComputedStyle(margin).display : 'N/A'
        });
      }
    }, 200);

    // Âº∫Âà∂Êõ¥Êñ∞Â∏ÉÂ±Ä
    setTimeout(() => {
      if (editor) {
        editor.layout();
        console.log('Monaco Editor layout updated');
      }
    }, 100);

    // ÁõëÂê¨ÂÜÖÂÆπÂèòÂåñÔºåËá™Âä®Ê†ºÂºèÂåñÂíå‰øùÂ≠òÂéÜÂè≤
    editor.onDidChangeModelContent(() => {
      clearTimeout(window.autoFormatTimeout);
      window.autoFormatTimeout = setTimeout(autoFormatJson, 500);

      // Â¶ÇÊûúÂú®ÊØîËæÉÊ®°ÂºèÔºåÊõ¥Êñ∞Â∑ÆÂºÇÈ´ò‰∫Æ
      if (isCompareMode) {
        highlightDifferences();
      }

      // ÊéßÂà∂ÊèêÁ§∫ÊòæÁ§∫/ÈöêËóè
      const hint = document.getElementById('editor-hint');
      if (hint) {
        const hasContent = getEditorContent().trim().length > 0;
        if (hasContent) {
          hint.classList.add('hint-hidden');
        } else {
          hint.classList.remove('hint-hidden');
        }
      }
    });

    // ÁõëÂê¨ JSON ÈîôËØØÊ†áËÆ∞ÂèòÂåñ
    monaco.editor.onDidChangeMarkers(() => {
      const errorElement = document.getElementById('json-validation-error');
      if (!errorElement) return;

      const model = editor.getModel();
      if (!model) return;

      const modelMarkers = model.getAllMarkers();
      if (modelMarkers.length === 0) {
        // Ê≤°ÊúâÈîôËØØÔºåÈöêËóèÊèêÁ§∫
        errorElement.classList.remove('show');
        errorElement.textContent = '';
      } else {
        // ÊúâÈîôËØØÔºåÊòæÁ§∫Á¨¨‰∏Ä‰∏™ÈîôËØØ
        const firstError = modelMarkers[0];
        const line = model.getLineContent(firstError.startLineNumber);
        const errorInfo = firstError.message;

        // Ëé∑ÂèñÂΩìÂâçËØ≠Ë®Ä
        const currentLang = window.appState.lang || 'en';
        const errorMessage = currentLang === 'zh'
          ? `Á¨¨ ${firstError.startLineNumber} Ë°åÈîôËØØÔºö${errorInfo}`
          : `Line ${firstError.startLineNumber} error: ${errorInfo}`;

        errorElement.textContent = errorMessage;
        errorElement.classList.add('show');
      }
    });
  }

  // Ëé∑ÂèñÁºñËæëÂô®‰∏≠ÁöÑÊñáÊú¨
  function getEditorContent() {
    return editor ? editor.getValue() : '';
  }

  // ËÆæÁΩÆÁºñËæëÂô®‰∏≠ÁöÑÊñáÊú¨
  function setEditorContent(content) {
    if (editor) {
      editor.setValue(content);
    }
  }

  // Ëá™Âä®Ê†ºÂºèÂåñÂáΩÊï∞
  function autoFormatJson() {
    const inputText = getEditorContent().trim();

    if (!inputText) {
      return;
    }

    try {
      // Â∞ùËØïËß£ÊûêJSON
      const parsed = JSON.parse(inputText);
      // Ê†ºÂºèÂåñJSON
      const formatted = JSON.stringify(parsed, null, 2);

      // Âè™ÊúâÂΩìÊ†ºÂºèÂåñÂêéÁöÑÂÜÖÂÆπ‰∏éÂΩìÂâç‰∏çÂêåÊó∂ÊâçÊõ¥Êñ∞
      if (formatted !== inputText) {
        // ‰øùÂ≠òÂΩìÂâçÂÖâÊ†á‰ΩçÁΩÆÂíåÊªöÂä®‰ΩçÁΩÆ
        const position = editor ? editor.getPosition() : null;
        const scrollTop = editor ? editor.getScrollTop() : null;

        // Êõ¥Êñ∞ÁºñËæëÂô®ÂÜÖÂÆπ
        setEditorContent(formatted);

        // ÊÅ¢Â§çÂÖâÊ†á‰ΩçÁΩÆÂíåÊªöÂä®‰ΩçÁΩÆ
        if (position && editor) {
          editor.setPosition(position);
        }
        if (scrollTop !== null && editor) {
          editor.setScrollTop(scrollTop);
        }
      }

      // ‰øùÂ≠òÂà∞ÂéÜÂè≤ËÆ∞ÂΩï
      saveToHistory(formatted);
    } catch (e) {
      // Ëß£ÊûêÂ§±Ë¥•Ôºå‰∏çÂÅöÂ§ÑÁêÜ
      console.debug('JSON parsing error:', e);
    }
  }

  // JSONÊ†ëÂΩ¢Êü•ÁúãÂô®
  class JsonViewer {
    constructor(containerId, data) {
      this.container = document.getElementById(containerId);
      if (!this.container) return;

      this.data = data;
      this.render();
      this.bindEvents();
    }

    render() {
      this.container.innerHTML = this.renderValue(this.data, '', true);
    }

    renderValue(value, key = '', hasNext = true) {
      if (value === null) {
        return this.renderProperty(key, `<span class="json-value-null">null</span>`, hasNext);
      }

      if (typeof value === 'object') {
        if (Array.isArray(value)) {
          return this.renderObjectOrArray(key, value, 'array', hasNext);
        } else {
          return this.renderObjectOrArray(key, value, 'object', hasNext);
        }
      }

      if (typeof value === 'string') {
        return this.renderProperty(key, `<span class="json-value-string">"${this.escapeHtml(value)}"</span>`, hasNext);
      }

      if (typeof value === 'number') {
        return this.renderProperty(key, `<span class="json-value-number">${value}</span>`, hasNext);
      }

      if (typeof value === 'boolean') {
        return this.renderProperty(key, `<span class="json-value-boolean">${value}</span>`, hasNext);
      }

      return this.renderProperty(key, value, hasNext);
    }

    renderProperty(key, value, hasNext) {
      if (key === '') {
        if (typeof value === 'object') {
          if (Array.isArray(value)) {
            return this.renderObjectContent(value, 'array');
          } else {
            return this.renderObjectContent(value, 'object');
          }
        }
        return `<div class="json-root">${value}${hasNext ? ',' : ''}</div>`;
      }

      return `
        <div class="json-property">
          <span class="json-toggle">‚ñº</span>
          <span class="json-key">"${key}"</span>
          <span class="json-separator">:</span>
          <span class="json-value">${value}</span>
          ${hasNext ? '<span>,</span>' : ''}
        </div>
      `;
    }

    renderObjectOrArray(key, value, type, hasNext) {
      const length = Array.isArray(value) ? value.length : Object.keys(value).length;
      const displayName = type === 'array' ? `[${length}]` : `{${length}}`;

      return `
        <div class="json-property collapsible">
          <span class="json-toggle">‚ñº</span>
          ${key ? `<span class="json-key">"${key}"</span><span class="json-separator">:</span>` : ''}
          <span class="json-value json-value-${type}">${displayName}</span>
          ${hasNext ? '<span>,</span>' : ''}
          <div class="json-node">${this.renderObjectContent(value)}</div>
        </div>
      `;
    }

    renderObjectContent(obj) {
      if (Array.isArray(obj)) {
        return `
          <div class="json-bracket">[</div>
          <div class="json-node">
            ${obj.map((item, index) => {
              const hasNext = index < obj.length - 1;
              return this.renderValue(item, '', hasNext);
            }).join('')}
          </div>
          <div class="json-bracket">]</div>
        `;
      } else {
        const entries = Object.entries(obj);
        return `
          <div class="json-bracket">{</div>
          <div class="json-node">
            ${entries.map(([key, value], index) => {
              const hasNext = index < entries.length - 1;
              return this.renderValue(value, key, hasNext);
            }).join('')}
          </div>
          <div class="json-bracket">}</div>
        `;
      }
    }

    escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    bindEvents() {
      this.container.addEventListener('click', (e) => {
        const toggle = e.target.closest('.json-toggle');
        if (toggle) {
          this.toggleNode(toggle);
        }
      });
    }

    toggleNode(toggle) {
      const property = toggle.parentElement;
      property.classList.toggle('collapsed');

      if (property.classList.contains('collapsed')) {
        toggle.textContent = '‚ñ∂';
      } else {
        toggle.textContent = '‚ñº';
      }
    }
  }

  // Â∞Ü JsonViewer Êö¥Èú≤Âà∞ÂÖ®Â±Ä
  window.JsonViewer = JsonViewer;

  // Â±ïÂºÄËæìÂá∫Âå∫Âüü
  function expandOutput(title = 'ËæìÂá∫ÁªìÊûú') {
    const outputArea = document.getElementById('output-area');
    const outputTitle = document.getElementById('output-title');
    outputArea.classList.add('expanded');
    outputTitle.textContent = title;
  }

  // ÂÖ≥Èó≠ËæìÂá∫Âå∫Âüü
  function closeOutput() {
    const outputArea = document.getElementById('output-area');
    outputArea.classList.remove('expanded');
  }

  // ÊòæÁ§∫JSONÁªìÊûú
  function showJsonResult(data, title = 'Ê†ºÂºèÂåñÁªìÊûú') {
    if (outputEditor) {
      const jsonStr = JSON.stringify(data, null, 2);
      outputEditor.setValue(jsonStr);
      expandOutput(title);
    } else {
      console.error('Output editor not initialized');
    }
  }

  function initializeJsonFormatter() {
    // Â∫îÁî®ÊèêÂèñÂáΩÊï∞
    document.getElementById('apply-extract').addEventListener('click', () => {
      applyExtractFunction();
    });

    // Ê∏ÖÁ©∫ÊèêÂèñÂáΩÊï∞ËæìÂÖ•Ê°Ü
    document.getElementById('clear-extract-fn').addEventListener('click', () => {
      document.getElementById('extract-fn').value = '';
    });

    // ÊåâÈíÆ‰∫ã‰ª∂ÁªëÂÆö
    document.getElementById('clear-btn').addEventListener('click', clearInputs);
    document.getElementById('collapse-all').addEventListener('click', collapseAll);
    document.getElementById('expand-all').addEventListener('click', expandAll);
    document.getElementById('remove-comments').addEventListener('click', removeComments);
    document.getElementById('compress-copy').addEventListener('click', () => compressAndCopy());
    document.getElementById('escape-copy').addEventListener('click', () => escapeAndCopy());
    document.getElementById('json-to-xml').addEventListener('click', () => jsonToXmlAndCopy());
    document.getElementById('json-to-ts').addEventListener('click', () => jsonToTsAndCopy());
    document.getElementById('json-to-csv').addEventListener('click', () => jsonToCsvAndCopy());
    document.getElementById('json-to-excel').addEventListener('click', () => jsonToExcelAndCopy());
    document.getElementById('json-compare').addEventListener('click', () => toggleCompareMode());
    document.getElementById('close-output').addEventListener('click', closeOutput);
    document.getElementById('history-btn').addEventListener('click', showHistory);

    // Â≠ó‰ΩìÂ§ßÂ∞èÈÄâÊã©Âô®
    const fontSizeSelect = document.getElementById('font-size-select');
    const savedFontSize = localStorage.getItem('editorFontSize') || '13';
    fontSizeSelect.value = savedFontSize;

    fontSizeSelect.addEventListener('change', (e) => {
      const fontSize = parseInt(e.target.value);
      if (editor) {
        editor.updateOptions({ fontSize: fontSize });
      }
      if (outputEditor) {
        outputEditor.updateOptions({ fontSize: fontSize });
      }
      localStorage.setItem('editorFontSize', fontSize);
    });
  }

  // Èò≤ÊäñÂáΩÊï∞
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  // Ê†ºÂºèÂåñËæìÂÖ•ÂáΩÊï∞Â∑≤ÁßªÈô§Ôºå‰ΩøÁî®Ëá™Âä®Ê†ºÂºèÂåñÊõø‰ª£

  // Ëß£ÊûêJSON
  function parseJson(str) {
    if (!str.trim()) return {};
    return JSON.parse(str);
  }

  // Â∫îÁî®ÊèêÂèñÂáΩÊï∞
  async function applyExtractFunction() {
    const extractFnStr = document.getElementById('extract-fn').value.trim();

    if (!extractFnStr) {
      alert(translations.enterExtractionFn || 'Please enter an extraction function');
      return;
    }

    try {
      const inputText = getEditorContent();
      if (!inputText.trim()) {
        alert(translations.enterData || 'Please enter data to process');
        return;
      }

      const parsedData = parseJson(inputText);
      const fn = new Function('obj', `return (${extractFnStr})(obj);`);
      const result = fn(parsedData);

      // Âè™ÊúâÂú®Â∫îÁî®ÊèêÂèñÂáΩÊï∞ÂêéÊâçÊòæÁ§∫ËæìÂá∫Ê°Ü
      showJsonResult(result, 'Extraction Result');
    } catch (error) {
      alert((translations.extractionError || 'Extraction error') + ': ' + error.message);
    }
  }

  // Ê∏ÖÁ©∫ËæìÂÖ•
  function clearInputs() {
    setEditorContent('');
    document.getElementById('extract-fn').value = '';
    if (outputEditor) {
      outputEditor.setValue('');
    }
    closeOutput();

    // ÈáçÊñ∞ÊòæÁ§∫ÊèêÁ§∫
    const hint = document.getElementById('editor-hint');
    if (hint) {
      hint.classList.remove('hint-hidden');
    }
  }

  // ÊäòÂè†ÊâÄÊúâ
  function collapseAll() {
    // ÊäòÂè†ËæìÂÖ•ÁºñËæëÂô®
    if (editor) {
      editor.getAction('editor.foldAll').run();
    }

    // ÊäòÂè†ËæìÂá∫ÁºñËæëÂô®
    if (outputEditor) {
      outputEditor.getAction('editor.foldAll').run();
    }
  }

  // Â±ïÂºÄÊâÄÊúâ
  function expandAll() {
    // Â±ïÂºÄËæìÂÖ•ÁºñËæëÂô®
    if (editor) {
      editor.getAction('editor.unfoldAll').run();
    }

    // Â±ïÂºÄËæìÂá∫ÁºñËæëÂô®
    if (outputEditor) {
      outputEditor.getAction('editor.unfoldAll').run();
    }
  }

  // ÂéªÈô§Ê≥®Èáä
  function removeComments() {
    let value = getEditorContent();
    value = value.replace(/\/\*[\s\S]*?\*\//g, '');
    value = value.replace(/\/\/.*/g, '');
    setEditorContent(value);
    // Ëß¶ÂèëËá™Âä®Ê†ºÂºèÂåñ
    autoFormatJson();
  }

  // ÂéãÁº©Âπ∂Â§çÂà∂
  async function compressAndCopy() {
    try {
      const parsedData = parseJson(getEditorContent());
      const compressed = JSON.stringify(parsedData);
      await navigator.clipboard.writeText(compressed);
      alert(translations.compressSuccess || 'Compressed JSON copied to clipboard!');
    } catch (error) {
      alert((translations.parsingError || 'Error') + ': ' + error.message);
    }
  }

  // ËΩ¨‰πâÂπ∂Â§çÂà∂
  async function escapeAndCopy() {
    try {
      const parsedData = parseJson(getEditorContent());
      const compressed = JSON.stringify(parsedData);
      const escaped = compressed.replace(/[\\]/g, '\\\\').replace(/["]/g, '\\"');
      await navigator.clipboard.writeText(escaped);
      alert(translations.escapeSuccess || 'Escaped JSON copied to clipboard!');
    } catch (error) {
      alert((translations.parsingError || 'Error') + ': ' + error.message);
    }
  }

  // JSONËΩ¨XMLÂπ∂Â§çÂà∂
  async function jsonToXmlAndCopy() {
    try {
      const parsedData = parseJson(getEditorContent());
      const xmlString = jsonToXml(parsedData, 'root');
      await navigator.clipboard.writeText(xmlString);
      alert(translations.xmlSuccess || 'XML copied to clipboard!');
    } catch (error) {
      alert((translations.parsingError || 'Error') + ': ' + error.message);
    }
  }

  // JSONËΩ¨TypeScriptÂπ∂Â§çÂà∂
  async function jsonToTsAndCopy() {
    try {
      const parsedData = parseJson(getEditorContent());
      const tsInterface = jsonToTsInterface(parsedData, 'DataType');
      await navigator.clipboard.writeText(tsInterface);
      alert(translations.tsSuccess || 'TypeScript interface copied to clipboard!');
    } catch (error) {
      alert((translations.parsingError || 'Error') + ': ' + error.message);
    }
  }

  // JSONËΩ¨CSVÂπ∂Â§çÂà∂
  async function jsonToCsvAndCopy() {
    try {
      const parsedData = parseJson(getEditorContent());
      const csvString = jsonToCsv(parsedData);
      await navigator.clipboard.writeText(csvString);
      alert(translations.csvSuccess || 'CSV copied to clipboard!');
    } catch (error) {
      alert((translations.parsingError || 'Error') + ': ' + error.message);
    }
  }

  // JSONËΩ¨ExcelÂπ∂Â§çÂà∂ÔºàÂÆûÈôÖÁîüÊàêCSVÊ†ºÂºèÔºåÂèØÁõ¥Êé•ÂØºÂÖ•ExcelÔºâ
  async function jsonToExcelAndCopy() {
    try {
      const parsedData = parseJson(getEditorContent());
      const csvString = jsonToCsv(parsedData);
      await navigator.clipboard.writeText(csvString);
      alert(translations.excelSuccess || 'Excel data copied to clipboard!');
    } catch (error) {
      alert((translations.parsingError || 'Error') + ': ' + error.message);
    }
  }

  // JSONËΩ¨XMLËæÖÂä©ÂáΩÊï∞
  function jsonToXml(obj, tagName) {
    if (obj === null || obj === undefined) {
      return `<${tagName}></${tagName}>`;
    }

    if (typeof obj !== 'object') {
      return `<${tagName}>${obj}</${tagName}>`;
    }

    if (Array.isArray(obj)) {
      return obj.map(item => jsonToXml(item, tagName)).join('');
    }

    let xml = `<${tagName}>`;
    for (const key in obj) {
      if (obj.hasOwnProperty(key)) {
        const value = obj[key];
        if (typeof value === 'object') {
          xml += jsonToXml(value, key);
        } else {
          xml += `<${key}>${value}</${key}>`;
        }
      }
    }
    xml += `</${tagName}>`;

    return xml;
  }

  // JSONËΩ¨CSVËæÖÂä©ÂáΩÊï∞
  function jsonToCsv(obj) {
    // Â§ÑÁêÜÁ©∫ÂÄº
    if (obj === null || obj === undefined) {
      throw new Error('Input data cannot be empty');
    }

    // Á°Æ‰øùËæìÂÖ•ÊòØÊï∞ÁªÑÔºåÂ¶ÇÊûúÊòØÂçï‰∏™ÂØπË±°ÂàôËΩ¨Êç¢‰∏∫Êï∞ÁªÑ
    const jsonArray = Array.isArray(obj) ? obj : [obj];

    // Â¶ÇÊûúÊï∞ÁªÑ‰∏∫Á©∫ÔºåËøîÂõûÁ©∫Â≠óÁ¨¶‰∏≤
    if (jsonArray.length === 0) {
      throw new Error('Input array cannot be empty');
    }

    // Ëé∑ÂèñÊâÄÊúâÂîØ‰∏ÄÁöÑÈîÆ‰Ωú‰∏∫CSVÊ†áÈ¢ò
    const headers = new Set();
    let hasValidData = false;
    jsonArray.forEach(item => {
      if (typeof item === 'object' && item !== null) {
        const keys = Object.keys(item);
        if (keys.length > 0) {
          hasValidData = true;
          keys.forEach(key => headers.add(key));
        }
      }
    });

    // Â¶ÇÊûúÊ≤°ÊúâÊúâÊïàÊï∞ÊçÆÔºåÊäõÂá∫ÈîôËØØ
    if (!hasValidData) {
      throw new Error('No valid data to convert');
    }

    // Â∞ÜSetËΩ¨Êç¢‰∏∫Êï∞ÁªÑ
    const headerArray = Array.from(headers);

    // ÁîüÊàêCSVÂÜÖÂÆπ
    let csv = headerArray.join(',') + '\n';

    // ÈÅçÂéÜÊï∞ÁªÑÁîüÊàêCSVË°å
    jsonArray.forEach(item => {
      const row = headerArray.map(header => {
        let value = item[header];
        // Â§ÑÁêÜÁ©∫ÂÄº
        if (value === null || value === undefined) {
          value = '';
        }
        // Â§ÑÁêÜÂ≠óÁ¨¶‰∏≤ÂåÖÂê´ÈÄóÂè∑„ÄÅÂºïÂè∑ÊàñÊç¢Ë°åÁ¨¶ÁöÑÊÉÖÂÜµ
        if (typeof value === 'string') {
          // ËΩ¨‰πâÂºïÂè∑
          value = value.replace(/"/g, '""');
          // Â¶ÇÊûúÂåÖÂê´ÈÄóÂè∑„ÄÅÂºïÂè∑ÊàñÊç¢Ë°åÁ¨¶ÔºåÁî®ÂºïÂè∑ÂåÖË£π
          if (value.includes(',') || value.includes('"') || value.includes('\n') || value.includes('\r')) {
            value = `"${value}"`;
          }
        }
        return value;
      });
      csv += row.join(',') + '\n';
    });

    return csv;
  }

  // JSONËΩ¨TypeScriptÊé•Âè£ËæÖÂä©ÂáΩÊï∞
  function jsonToTsInterface(obj, interfaceName) {
    if (typeof obj !== 'object' || obj === null) {
      return `// Cannot generate interface from non-object type`;
    }

    // If it's an array, use the first element to generate the interface
    let targetObj = obj;
    if (Array.isArray(obj)) {
      if (obj.length === 0) {
        return `// Cannot generate interface from empty array`;
      }
      // Use the first element of the array to generate the interface
      targetObj = obj[0];
      // If the first element is not an object, return error message
      if (typeof targetObj !== 'object' || targetObj === null) {
        return `// Cannot generate interface from non-object type`;
      }
    }

    let ts = `interface ${interfaceName} {\n`;

    for (const key in targetObj) {
      if (targetObj.hasOwnProperty(key)) {
        const value = targetObj[key];
        let type;

        if (value === null) {
          type = 'any';
        } else if (Array.isArray(value)) {
          if (value.length > 0) {
            const elementType = typeof value[0];
            if (elementType === 'object' && value[0] !== null) {
              // If array elements are objects, generate nested interface
              const nestedInterfaceName = `${key.charAt(0).toUpperCase() + key.slice(1)}Item`;
              type = `${nestedInterfaceName}[]`;
              ts += jsonToTsInterface(value[0], nestedInterfaceName);
            } else {
              // Otherwise use basic type
              type = `${getType(elementType)}[]`;
            }
          } else {
            type = 'any[]';
          }
        } else if (typeof value === 'object') {
          type = `${key.charAt(0).toUpperCase() + key.slice(1)}Type`;
          ts += jsonToTsInterface(value, type);
        } else {
          type = getType(typeof value);
        }

        ts += `  ${key}: ${type};\n`;
      }
    }

    ts += `}\n`;
    
    // If original input was an array, generate array type export
    if (Array.isArray(obj)) {
      ts += `\nexport type ${interfaceName}Array = ${interfaceName}[];\n`;
    }
    
    return ts;
  }

  // Ëé∑ÂèñÁ±ªÂûãÂ≠óÁ¨¶‰∏≤
  function getType(jsType) {
    switch(jsType) {
      case 'string': return 'string';
      case 'number': return 'number';
      case 'boolean': return 'boolean';
      case 'object': return 'object';
      default: return 'any';
    }
  }

  // Êú¨Âú∞Â≠òÂÇ®Áõ∏ÂÖ≥ÂáΩÊï∞
  const HISTORY_KEY = 'json-formatter-history';
  const MAX_HISTORY_ITEMS = 50;

  // ‰øùÂ≠òÂéÜÂè≤ËÆ∞ÂΩï
  function saveToHistory(data) {
    try {
      const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
      
      // ÁßªÈô§ÈáçÂ§çÈ°π
      const filteredHistory = history.filter(item => item.data !== data);
      
      // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩïÂºÄÂ§¥
      filteredHistory.unshift({
        id: Date.now(),
        data: data,
        timestamp: new Date().toISOString()
      });
      
      // ÈôêÂà∂ÂéÜÂè≤ËÆ∞ÂΩïÊï∞Èáè
      const limitedHistory = filteredHistory.slice(0, MAX_HISTORY_ITEMS);
      
      localStorage.setItem(HISTORY_KEY, JSON.stringify(limitedHistory));
    } catch (error) {
      console.error('‰øùÂ≠òÂéÜÂè≤ËÆ∞ÂΩïÂ§±Ë¥•:', error);
    }
  }

  // Ëé∑ÂèñÂéÜÂè≤ËÆ∞ÂΩï
  function getHistory() {
    try {
      return JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
    } catch (error) {
      console.error('Ëé∑ÂèñÂéÜÂè≤ËÆ∞ÂΩïÂ§±Ë¥•:', error);
      return [];
    }
  }

  // Ê∏ÖÈô§ÂéÜÂè≤ËÆ∞ÂΩï
  function clearHistory() {
    try {
      localStorage.removeItem(HISTORY_KEY);
    } catch (error) {
      console.error('Ê∏ÖÈô§ÂéÜÂè≤ËÆ∞ÂΩïÂ§±Ë¥•:', error);
    }
  }

  // ÊòæÁ§∫ÂéÜÂè≤ËÆ∞ÂΩï
  function showHistory() {
    const history = getHistory();
    
    if (history.length === 0) {
      alert('No history records');
      return;
    }
    
    // ÂàõÂª∫ÈÅÆÁΩ©Â±Ç
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    `;
    
    // ÂàõÂª∫ÂéÜÂè≤ËÆ∞ÂΩïÂºπÁ™ó
    const historyContainer = document.createElement('div');
    historyContainer.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      width: 90%;
      max-width: 1200px;
      max-height: 90%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    `;
    
    // ÂàõÂª∫Ê†áÈ¢òË°å
    const header = document.createElement('div');
    header.style.cssText = `
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    `;
    
    // ÂàõÂª∫Ê†áÈ¢ò
    const title = document.createElement('h3');
    title.textContent = 'History';
    title.style.cssText = `
      margin: 0;
      font-size: 18px;
    `;
    header.appendChild(title);
    
    // ÂàõÂª∫ÂÖ≥Èó≠ÊåâÈíÆ
    const closeBtn = document.createElement('button');
    closeBtn.textContent = '√ó';
    closeBtn.style.cssText = `
      background: transparent;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: background-color 0.2s;
    `;
    
    closeBtn.onmouseenter = () => {
      closeBtn.style.backgroundColor = '#f5f5f5';
    };
    
    closeBtn.onmouseleave = () => {
      closeBtn.style.backgroundColor = 'transparent';
    };
    
    closeBtn.onclick = () => {
      document.body.removeChild(overlay);
      document.body.removeChild(historyContainer);
    };
    
    header.appendChild(closeBtn);
    historyContainer.appendChild(header);
    
    // ÂàõÂª∫ÊêúÁ¥¢Ê°Ü
    const searchContainer = document.createElement('div');
    searchContainer.style.cssText = `
      margin-bottom: 15px;
    `;
    
    const searchInput = document.createElement('input');
    searchInput.type = 'text';
    searchInput.placeholder = 'ÊêúÁ¥¢ÂéÜÂè≤ËÆ∞ÂΩï...';
    searchInput.style.cssText = `
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    `;
    
    searchContainer.appendChild(searchInput);
    historyContainer.appendChild(searchContainer);
    
    // ÂàõÂª∫Ê∏ÖÈô§ÂéÜÂè≤ËÆ∞ÂΩïÊåâÈíÆ
    const clearBtn = document.createElement('button');
    clearBtn.textContent = 'Ê∏ÖÈô§ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩï';
    clearBtn.style.cssText = `
      margin-bottom: 15px;
      padding: 8px 16px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    `;
    
    clearBtn.onmouseenter = () => {
      clearBtn.style.backgroundColor = '#dc2626';
    };
    
    clearBtn.onmouseleave = () => {
      clearBtn.style.backgroundColor = '#ef4444';
    };
    
    clearBtn.onclick = () => {
      if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩïÂêóÔºü')) {
        clearHistory();
        document.body.removeChild(overlay);
        document.body.removeChild(historyContainer);
        showToast('ÂéÜÂè≤ËÆ∞ÂΩïÂ∑≤Ê∏ÖÈô§');
      }
    };
    
    historyContainer.appendChild(clearBtn);
    
    // ÂàõÂª∫Ë°®Ê†ºÂÆπÂô®
    const tableContainer = document.createElement('div');
    tableContainer.style.cssText = `
      flex: 1;
      overflow: auto;
      border: 1px solid #ddd;
      border-radius: 4px;
    `;
    
    // ÂàõÂª∫Ë°®Ê†º
    const table = document.createElement('table');
    table.style.cssText = `
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    `;
    
    // ÂàõÂª∫Ë°®Â§¥
    const thead = document.createElement('thead');
    thead.style.cssText = `
      background-color: #f9fafb;
      position: sticky;
      top: 0;
      z-index: 10;
    `;
    
    const headerRow = document.createElement('tr');
    const headers = ['Â∫èÂè∑', 'Êó∂Èó¥', 'JSONÊï∞ÊçÆ', 'Êìç‰Ωú'];
    const headerWidths = ['60px', '150px', 'auto', '120px'];
    
    headers.forEach((headerText, index) => {
      const th = document.createElement('th');
      th.textContent = headerText;
      th.style.cssText = `
        padding: 10px 8px;
        text-align: left;
        border-bottom: 2px solid #ddd;
        font-weight: 600;
        width: ${headerWidths[index]};
      `;
      headerRow.appendChild(th);
    });
    
    thead.appendChild(headerRow);
    table.appendChild(thead);
    
    // ÂàõÂª∫Ë°®‰Ωì
    const tbody = document.createElement('tbody');
    
    // Ê∑ªÂä†ËÆ∞ÂΩïÂà∞Ë°®Ê†ºÁöÑÂáΩÊï∞
    function addRecordsToTable(records) {
      tbody.innerHTML = '';
      
      records.forEach((item, index) => {
        const tr = document.createElement('tr');
        tr.style.cssText = `
          border-bottom: 1px solid #eee;
          transition: background-color 0.2s;
        `;
        
        tr.onmouseenter = () => {
          tr.style.backgroundColor = '#f5f5f5';
        };
        
        tr.onmouseleave = () => {
          tr.style.backgroundColor = 'transparent';
        };
        
        // Â∫èÂè∑Âàó
        const indexTd = document.createElement('td');
        indexTd.textContent = index + 1;
        indexTd.style.cssText = `
          padding: 8px;
          text-align: center;
          font-weight: 500;
        `;
        tr.appendChild(indexTd);
        
        // Êó∂Èó¥Âàó
        const timeTd = document.createElement('td');
        timeTd.textContent = new Date(item.timestamp).toLocaleString();
        timeTd.style.cssText = `
          padding: 8px;
          color: #666;
        `;
        tr.appendChild(timeTd);
        
        // JSONÊï∞ÊçÆÂàó
        const dataTd = document.createElement('td');
        dataTd.style.cssText = `
          padding: 8px;
          max-width: 500px;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
          font-size: 12px;
          cursor: pointer;
          color: #2563eb;
        `;
        
        const jsonPreview = item.data.substring(0, 150) + (item.data.length > 150 ? '...' : '');
        dataTd.textContent = jsonPreview;
        dataTd.title = 'ÁÇπÂáªÂ§çÂà∂ÂÆåÊï¥JSON';
        
        // ÁÇπÂáªJSONÊï∞ÊçÆÂ§çÂà∂Âà∞Ââ™Ë¥¥Êùø
        dataTd.onclick = (e) => {
          e.stopPropagation();
          navigator.clipboard.writeText(item.data).then(() => {
            showToast('JSONÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
          }).catch(err => {
            console.error('Â§çÂà∂Â§±Ë¥•:', err);
            showToast('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          });
        };
        
        tr.appendChild(dataTd);
        
        // Êìç‰ΩúÂàó
        const actionTd = document.createElement('td');
        actionTd.style.cssText = `
          padding: 8px;
          display: flex;
          gap: 6px;
          justify-content: center;
        `;
        
        // Â§çÂà∂ÊåâÈíÆ
        const copyBtn = document.createElement('button');
        copyBtn.textContent = 'Â§çÂà∂';
        copyBtn.style.cssText = `
          padding: 4px 8px;
          background: #3b82f6;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 12px;
          transition: background-color 0.2s;
        `;
        
        copyBtn.onmouseenter = () => {
          copyBtn.style.backgroundColor = '#2563eb';
        };
        
        copyBtn.onmouseleave = () => {
          copyBtn.style.backgroundColor = '#3b82f6';
        };
        
        copyBtn.onclick = (e) => {
          e.stopPropagation();
          navigator.clipboard.writeText(item.data).then(() => {
            showToast('JSONÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
          }).catch(err => {
            console.error('Â§çÂà∂Â§±Ë¥•:', err);
            showToast('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          });
        };
        
        actionTd.appendChild(copyBtn);
        
        // Âà†Èô§ÊåâÈíÆ
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Âà†Èô§';
        deleteBtn.style.cssText = `
          padding: 4px 8px;
          background: #ef4444;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 12px;
          transition: background-color 0.2s;
        `;
        
        deleteBtn.onmouseenter = () => {
          deleteBtn.style.backgroundColor = '#dc2626';
        };
        
        deleteBtn.onmouseleave = () => {
          deleteBtn.style.backgroundColor = '#ef4444';
        };
        
        deleteBtn.onclick = (e) => {
          e.stopPropagation();
          if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºü')) {
            const updatedHistory = history.filter(h => h.id !== item.id);
            localStorage.setItem(HISTORY_KEY, JSON.stringify(updatedHistory));
            // Êõ¥Êñ∞Ë°®Ê†º
            const filteredHistory = searchInput.value 
              ? updatedHistory.filter(h => h.data.includes(searchInput.value))
              : updatedHistory;
            addRecordsToTable(filteredHistory);
            showToast('ËÆ∞ÂΩïÂ∑≤Âà†Èô§');
          }
        };
        
        actionTd.appendChild(deleteBtn);
        tr.appendChild(actionTd);
        
        // ÁÇπÂáªÊï¥Ë°åÊÅ¢Â§çÊï∞ÊçÆ
        tr.onclick = () => {
          setEditorContent(item.data);
          autoFormatJson();
          document.body.removeChild(overlay);
          document.body.removeChild(historyContainer);
        };
        
        tbody.appendChild(tr);
      });
    }
    
    // ÂàùÂßãÂä†ËΩΩÊâÄÊúâËÆ∞ÂΩï
    addRecordsToTable(history);
    
    table.appendChild(tbody);
    tableContainer.appendChild(table);
    historyContainer.appendChild(tableContainer);
    
    // Ê∑ªÂä†ÊêúÁ¥¢ÂäüËÉΩ
    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      const filteredHistory = history.filter(item => 
        item.data.toLowerCase().includes(searchTerm)
      );
      addRecordsToTable(filteredHistory);
    });
    
    // ÁÇπÂáªÈÅÆÁΩ©Â±ÇÂÖ≥Èó≠ÂºπÁ™ó
    overlay.onclick = () => {
      document.body.removeChild(overlay);
      document.body.removeChild(historyContainer);
    };
    
    // Ê∑ªÂä†Âà∞È°µÈù¢
    document.body.appendChild(overlay);
    document.body.appendChild(historyContainer);
  }

  // ÂàáÊç¢ÊØîËæÉÊ®°Âºè
  function toggleCompareMode() {
    const compareSection = document.getElementById('compare-section');
    const editorsWrapper = document.getElementById('editors-wrapper');
    const firstSection = document.querySelector('.input-section');

    if (!isCompareMode) {
      // ËøõÂÖ•ÊØîËæÉÊ®°Âºè - ÊòæÁ§∫Á¨¨‰∫å‰∏™ÁºñËæëÂô®
      isCompareMode = true;
      compareSection.classList.remove('hidden');
      editorsWrapper.classList.add('compare-mode');

      // Êõ¥Êñ∞Á¨¨‰∏Ä‰∏™ÁºñËæëÂô®Ê†áÈ¢ò
      const firstLabel = firstSection.querySelector('.section-label');
      if (firstLabel) {
        firstLabel.textContent = translations.leftJson || 'Left JSON';
      }

      // Á´ãÂç≥Êõ¥Êñ∞Â∑ÆÂºÇÈ´ò‰∫Æ
      highlightDifferences();
    } else {
      // ÈÄÄÂá∫ÊØîËæÉÊ®°Âºè
      isCompareMode = false;
      compareSection.classList.add('hidden');
      editorsWrapper.classList.remove('compare-mode');

      // ÊÅ¢Â§çÁºñËæëÂô®Ê†áÈ¢ò
      const firstLabel = firstSection.querySelector('.section-label');
      if (firstLabel) {
        firstLabel.textContent = 'All-in-One JSON Viewer';
      }

      // Ê∏ÖÈô§È´ò‰∫Æ
      clearHighlightDecorations();

      // Ê∏ÖÁ©∫ÊØîËæÉÁºñËæëÂô®
      if (compareEditor) {
        compareEditor.setValue('');
      }
    }

    // Êõ¥Êñ∞Â∏ÉÂ±Ä
    setTimeout(() => {
      if (editor) editor.layout();
      if (compareEditor) compareEditor.layout();
      if (outputEditor) outputEditor.layout();
    }, 100);
  }

// Âú®‰∏§‰∏™ÁºñËæëÂô®‰∏≠È´ò‰∫ÆÊòæÁ§∫Â∑ÆÂºÇ
  function highlightDifferences() {
    if (!editor || !compareEditor) return;

    // Ê∏ÖÈô§‰πãÂâçÁöÑË£ÖÈ•∞
    clearHighlightDecorations();

    try {
      const leftText = editor.getValue();
      const rightText = compareEditor.getValue();

      if (!leftText.trim() || !rightText.trim()) return;

      const leftJson = JSON.parse(leftText);
      const rightJson = JSON.parse(rightText);

      // ÊâæÂá∫Â∑ÆÂºÇÔºåÂåÖÂê´Á≤æÁ°ÆÁöÑË°åÂè∑ÂíåÂàóÂè∑‰ø°ÊÅØ
      const differences = findDifferencesWithLineNumbers(leftText, rightText, leftJson, rightJson);

      // Âú®Â∑¶‰æßÁºñËæëÂô®‰∏≠È´ò‰∫ÆÂ∑ÆÂºÇ
      const leftDecorationsData = differences
        .filter(d => d.type === 'removed' || d.type === 'changed')
        .map(d => ({
          range: new monaco.Range(
            d.line || 1,
            d.startColumn || 1,
            d.line || 1,
            d.endColumn || 1000
          ),
          options: {
            className: d.type === 'removed' ? 'diff-removed-decoration' : 'diff-changed-decoration',
            hoverMessage: { value: d.message },
            isWholeLine: d.isWholeLine || false
          }
        }));

      // Âú®Âè≥‰æßÁºñËæëÂô®‰∏≠È´ò‰∫ÆÂ∑ÆÂºÇ
      const rightDecorationsData = differences
        .filter(d => d.type === 'added' || d.type === 'changed')
        .map(d => ({
          range: new monaco.Range(
            d.line || 1,
            d.startColumn || 1,
            d.line || 1,
            d.endColumn || 1000
          ),
          options: {
            className: d.type === 'added' ? 'diff-added-decoration' : 'diff-changed-decoration',
            hoverMessage: { value: d.message },
            isWholeLine: d.isWholeLine || false
          }
        }));

      // Â∫îÁî®Ë£ÖÈ•∞
      if (editor && leftDecorationsData.length > 0) {
        leftDecorations = editor.deltaDecorations([], leftDecorationsData);
      }
      if (compareEditor && rightDecorationsData.length > 0) {
        rightDecorations = compareEditor.deltaDecorations([], rightDecorationsData);
      }
    } catch (error) {
      // JSONËß£ÊûêÂ§±Ë¥•Ôºå‰∏çÊòæÁ§∫È´ò‰∫Æ
      console.debug('Highlight differences error:', error);
    }
  }

// Êü•ÊâæÂ∑ÆÂºÇÔºàËøîÂõûÂ∏¶Á≤æÁ°ÆË°åÂè∑‰ø°ÊÅØÁöÑÂ∑ÆÂºÇÔºâ
  function findDifferencesWithLineNumbers(leftText, rightText, leftJson, rightJson) {
    const differences = [];

    // Ëß£ÊûêÊñáÊú¨Ë°åÔºåÁî®‰∫éÁ≤æÁ°ÆÂÆö‰Ωç
    const leftLines = leftText.split('\n');
    const rightLines = rightText.split('\n');

    function findKeyInLines(key, lines, startLine = 0) {
      const keyPattern = new RegExp(`"${key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}"\\s*:`);
      for (let i = startLine; i < lines.length; i++) {
        if (keyPattern.test(lines[i])) {
          const match = lines[i].match(keyPattern);
          if (match) {
            return {
              line: i + 1,
              startColumn: match.index + 1,
              endColumn: lines[i].length
            };
          }
        }
      }
      return { line: 1, startColumn: 1, endColumn: 1000 };
    }

    function compare(val1, val2, currentPath, parentLine = 1) {
      const type1 = typeof val1;
      const type2 = typeof val2;

      // Á±ªÂûã‰∏çÂêå
      if (type1 !== type2) {
        const keyName = currentPath.split('.').pop();
        const position = findKeyInLines(keyName, leftLines, parentLine - 1);
        
        differences.push({
          type: 'changed',
          path: currentPath,
          oldValue: val1,
          newValue: val2,
          message: `${currentPath}: ${JSON.stringify(val1)} ‚Üí ${JSON.stringify(val2)}`,
          line: position.line,
          startColumn: position.startColumn,
          endColumn: position.endColumn,
          isWholeLine: false
        });
        return;
      }

      // Â¶ÇÊûúÊòØÂØπË±°ÊàñÊï∞ÁªÑÔºåÈÄíÂΩíÊØîËæÉ
      if (type1 === 'object' && val1 !== null && val2 !== null) {
        const keys1 = Object.keys(val1);
        const keys2 = Object.keys(val2);
        const allKeys = new Set([...keys1, ...keys2]);

        allKeys.forEach(key => {
          const newPath = currentPath ? `${currentPath}.${key}` : key;
          
          if (!(key in val1)) {
            // Êñ∞Â¢û - Âú®Âè≥‰æßÊñáÊú¨‰∏≠Êü•Êâæ‰ΩçÁΩÆ
            const position = findKeyInLines(key, rightLines);
            differences.push({
              type: 'added',
              path: newPath,
              value: val2[key],
              message: `${newPath}: + ${JSON.stringify(val2[key])}`,
              line: position.line,
              startColumn: position.startColumn,
              endColumn: position.endColumn,
              isWholeLine: false
            });
          } else if (!(key in val2)) {
            // Âà†Èô§ - Âú®Â∑¶‰æßÊñáÊú¨‰∏≠Êü•Êâæ‰ΩçÁΩÆ
            const position = findKeyInLines(key, leftLines);
            differences.push({
              type: 'removed',
              path: newPath,
              value: val1[key],
              message: `${newPath}: - ${JSON.stringify(val1[key])}`,
              line: position.line,
              startColumn: position.startColumn,
              endColumn: position.endColumn,
              isWholeLine: false
            });
          } else {
            // ÈÄíÂΩíÊØîËæÉ
            const keyPosition = findKeyInLines(key, leftLines);
            compare(val1[key], val2[key], newPath, keyPosition.line);
          }
        });
      } else if (val1 !== val2) {
        // ÂÄº‰∏çÂêå
        const keyName = currentPath.split('.').pop();
        const position = findKeyInLines(keyName, leftLines);
        
        differences.push({
          type: 'changed',
          path: currentPath,
          oldValue: val1,
          newValue: val2,
          message: `${currentPath}: ${JSON.stringify(val1)} ‚Üí ${JSON.stringify(val2)}`,
          line: position.line,
          startColumn: position.startColumn,
          endColumn: position.endColumn,
          isWholeLine: false
        });
      }
    }

    compare(leftJson, rightJson, '');

    return differences;
  }

// ‰øùÁïôÂéüÊúâÁöÑÁÆÄÂçïÂ∑ÆÂºÇÊ£ÄÊµãÂáΩÊï∞‰Ωú‰∏∫Â§áÁî®
  function findDifferences(obj1, obj2, path = '', depth = 0) {
    const differences = [];

    function compare(val1, val2, currentPath, currentLine = 0) {
      const type1 = typeof val1;
      const type2 = typeof val2;

      // Á±ªÂûã‰∏çÂêå
      if (type1 !== type2) {
        differences.push({
          type: 'changed',
          path: currentPath,
          oldValue: val1,
          newValue: val2,
          message: `${currentPath}: ${JSON.stringify(val1)} ‚Üí ${JSON.stringify(val2)}`,
          line: currentLine
        });
        return;
      }

      // Â¶ÇÊûúÊòØÂØπË±°ÊàñÊï∞ÁªÑÔºåÈÄíÂΩíÊØîËæÉ
      if (type1 === 'object' && val1 !== null && val2 !== null) {
        const keys1 = Object.keys(val1);
        const keys2 = Object.keys(val2);
        const allKeys = new Set([...keys1, ...keys2]);

        allKeys.forEach((key, index) => {
          const newPath = currentPath ? `${currentPath}.${key}` : key;
          const lineOffset = Math.floor(index / 5); // ‰º∞ÁÆóË°åÂè∑

          if (!(key in val1)) {
            // Êñ∞Â¢û
            differences.push({
              type: 'added',
              path: newPath,
              value: val2[key],
              message: `${newPath}: + ${JSON.stringify(val2[key])}`,
              line: currentLine + lineOffset
            });
          } else if (!(key in val2)) {
            // Âà†Èô§
            differences.push({
              type: 'removed',
              path: newPath,
              value: val1[key],
              message: `${newPath}: - ${JSON.stringify(val1[key])}`,
              line: currentLine + lineOffset
            });
          } else {
            // ÈÄíÂΩíÊØîËæÉ
            compare(val1[key], val2[key], newPath, currentLine + lineOffset);
          }
        });
      } else if (val1 !== val2) {
        // ÂÄº‰∏çÂêå
        differences.push({
          type: 'changed',
          path: currentPath,
          oldValue: val1,
          newValue: val2,
          message: `${currentPath}: ${JSON.stringify(val1)} ‚Üí ${JSON.stringify(val2)}`,
          line: currentLine
        });
      }
    }

    compare(obj1, obj2, path);

    return differences;
  }

  // Ê∏ÖÈô§È´ò‰∫ÆË£ÖÈ•∞
  function clearHighlightDecorations() {
    if (editor && leftDecorations.length > 0) {
      editor.deltaDecorations(leftDecorations, []);
      leftDecorations = [];
    }
    if (compareEditor && rightDecorations.length > 0) {
      compareEditor.deltaDecorations(rightDecorations, []);
      rightDecorations = [];
    }
  }

  // ÊòæÁ§∫ToastÊèêÁ§∫
  function showToast(message) {
    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊúâToast
    let toast = document.getElementById('toast-message');
    if (toast) {
      toast.remove();
    }
    
    toast = document.createElement('div');
    toast.id = 'toast-message';
    toast.textContent = message;
    toast.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 12px 20px;
      border-radius: 4px;
      z-index: 1001;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: slideIn 0.3s ease-out;
    `;
    
    // Ê∑ªÂä†Âä®ÁîªÊ†∑Âºè
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(toast);
    
    // 3ÁßíÂêéÁßªÈô§Toast
    setTimeout(() => {
      toast.style.animation = 'slideIn 0.3s ease-out reverse';
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
        if (style.parentNode) {
          style.parentNode.removeChild(style);
        }
      }, 300);
    }, 3000);
  }
</script>
